<!doctype html><html lang=ko dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>파이썬으로 쿠팡 파트너스 API 활용하기 - 2 상품 이미지 가져오기 | Jaejin's blog</title>
<meta name=keywords content="python,쿠팡파트너스,coupangpartners"><meta name=description content="안녕하세요. 저번 시간에 파트너스 API를 통해서 상품정보를 가져오는 것까지 했습니다. 오늘은 쿠팡에 있는 상품 이미지 가져오는 방법에 대해서 설명하겠습니다."><meta name=author content="Jaejin Jang"><link rel=canonical href=https://jaejin0me.github.io/post/20200101/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://jaejin0me.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jaejin0me.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://jaejin0me.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://jaejin0me.github.io/apple-touch-icon.png><link rel=mask-icon href=https://jaejin0me.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-F8504X956T"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F8504X956T",{anonymize_ip:!0})}</script><meta property="og:title" content="파이썬으로 쿠팡 파트너스 API 활용하기 - 2 상품 이미지 가져오기"><meta property="og:description" content="안녕하세요. 저번 시간에 파트너스 API를 통해서 상품정보를 가져오는 것까지 했습니다. 오늘은 쿠팡에 있는 상품 이미지 가져오는 방법에 대해서 설명하겠습니다."><meta property="og:type" content="article"><meta property="og:url" content="https://jaejin0me.github.io/post/20200101/"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-01-01T07:12:52+09:00"><meta property="article:modified_time" content="2020-01-01T07:12:52+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="파이썬으로 쿠팡 파트너스 API 활용하기 - 2 상품 이미지 가져오기"><meta name=twitter:description content="안녕하세요. 저번 시간에 파트너스 API를 통해서 상품정보를 가져오는 것까지 했습니다. 오늘은 쿠팡에 있는 상품 이미지 가져오는 방법에 대해서 설명하겠습니다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://jaejin0me.github.io/post/"},{"@type":"ListItem","position":3,"name":"파이썬으로 쿠팡 파트너스 API 활용하기 - 2 상품 이미지 가져오기","item":"https://jaejin0me.github.io/post/20200101/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"파이썬으로 쿠팡 파트너스 API 활용하기 - 2 상품 이미지 가져오기","name":"파이썬으로 쿠팡 파트너스 API 활용하기 - 2 상품 이미지 가져오기","description":"안녕하세요. 저번 시간에 파트너스 API를 통해서 상품정보를 가져오는 것까지 했습니다. 오늘은 쿠팡에 있는 상품 이미지 가져오는 방법에 대해서 설명하겠습니다.","keywords":["python","쿠팡파트너스","coupangpartners"],"articleBody":"안녕하세요.\n저번 시간에 파트너스 API를 통해서 상품정보를 가져오는 것까지 했습니다.\n오늘은 쿠팡에 있는 상품 이미지 가져오는 방법에 대해서 설명하겠습니다.\nAPI를 호출해 가져온 상품정보에 접속할 수 있는 URL이 있었는데요.\n그 URL를 통해 상품페이지로 접속해서 이미지를 가져올꺼에요. 오늘꺼 조금 깁니다…\n용어 대~충 설명 파싱 : 가져오는 것? ㅋㅋ (ex. 문자열을 파싱한다 = 문자열을 가져온다) 이번에 설명할 내용 상품URL을 타고 상품페이지에 접속해서 상품타이틀, 이미지 가져오기 시작하기 전에 간단히 알아야할 것들 웹페이지는 구성하는 요소에는 정적인 정보와 동적인 정보가 있습니다. 정적인 정보는 일반적인 html 태그라고 생각하시면 되고 동적인 정보는 자바스크립트가 들어가있는 부분이라고 생각하시면 돼요. 근데 이 자바스크립트는 웹브라우저에서 처리를 해주기 때문에 웹브라우저로 접속하지 않으면 처리가 안되서 정보를 가져올 수가 없습니다. 그래서 웹브라우저를 컨트롤할 수 있는 놈을 이용하는데요. 보통 “셀레니움\"을 사용합니다(저는 셀레니움밖에 몰라서 다른것도 있는지 모르겠네요 ㅎㅎ) 셀레니움이 웹브라우저를 컨트롤 하는건 아니고, 브라우저별로 웹드라이버가 있는데 그 웹드라이버를 셀레니움을 이용해서 컨트롤할 수 가 있어요 ㅎㅎ 출처 : https://www.slideshare.net/JiLee24/selenium-113082253 암튼 중요한 것은 웹드라이버가 필요하고 셀레니움으로 컨트롤 한다는 것입니다. 다들 크롬을 많으 쓰시니까 크롬웹드라이버를 이용할 꺼고, 셀레니움은 파이썬 셀레니움 패키지를 설치하면 됩니다. 크롬웹드라이버 다운 우선 본인이 사용하는 크롬버전을 확인하시고요. 크롬웹드라이버 사이트 https://chromedriver.chromium.org/downloads 에 접속하셔서 받으시면 됩니다. ​ 파이썬 v3 셀레니움 패키지 설치 파이썬은 패키지설치할때 pip를 사용합니다. 우리는 파이썬 v3 이니깐 pip3 이겠죠?ㅎㅎ 명령어 창에서 “pip3 install selenium” 이렇게 치시면 설치됩니다. 저는 이미 설치되어 있으니까 already ~~ 하고 나오네요. 코드의 흐름 및 간단 설명 웹드라이버 실행 URL로 상품페이지 접근 타이틀, 이미지 찾기 이미지 다운로드 1. 웹드라이버 실행 1 2 3 4 5 6 7 8 9 10 11 # ~~ self.options = webdriver.ChromeOptions() self.options.add_argument('headless') self.options.add_argument(\"user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36\") self.options.add_argument(\"lang=ko_KR\") self.webdriverpath = os.getcwd() + r\"\\chromedriver.exe\" # ~~ driver = webdriver.Chrome(self.webdriverpath, options=self.options) time.sleep(5) 웹드라이버를 소스코드랑 동일한 폴더에 위치해 놓으셔야 됩니다. 웹드라이버를 실행할때 다양한 옵션들을 줄수가 있습니다. 제가 제공하는 코드에는 이런저런 옵션이 있는데요. 음 그냥 크롤링(자동으로 돌아다니면서 웹페이지를 파싱하는 것) 방지를 우회하기 위해서 넣어놨다고 생각하시면 됩니다. 필요없는 옵션들도 있는데 그냥 뭐가 필요하고 안필요한지 구분하는것도 귀찮아서 우선 넣어 놨습니다. 선택가능한 옵션은 headless 입니다. 프로그램이 동작하는 걸 보고싶은 분은 삭제하시거나 주석처리해서 실행해보세요. 자동으로 웹브라우저가 떠서 동작하는 걸 보실 수 있을꺼에요. 저 옵션을 설정하는게 컴퓨터의 리소스를 적게 먹으니가 보통 설정해 놓는 편이에요^^. 개발할때에는 빼놨다가 다 끝나면 설정하는 편입니다. 중간에 sleep()이 있는데요. 실행하는데 시간이 조금 걸릴테니까 기다려주는 부분이라고 생각하시며 됩니다. 2. URL로 상품페이지 접근 1 2 producturl = each_product['productUrl'] driver.get(producturl) 간~단합니다. 저번시간에 키워드로 검색하는 API 써서 정보를 얻었을때 보면 “productUrl” 이라는 요소가 있었습니다. 그 요소에 접근해서 url을 가져오고 웹드라이버를 컨트롤 해서 접근합니다. 3. 타이틀, 이미지 Element 찾기 웹페이지에서 타이틀과 이미지 엘리먼트를 찾을꺼에요. 이 부분은 음 설명은 할텐데 이해가 안가실 수도 있어요. 궁금하신분은 개인적으로 좀더 찾아보셔야 될 것 같습니다. 웹페이지를 구성하는 엘리먼트들에는 이름들이 있어요. 그래서 그 이름을 이용해서 찾으면 됩니다. 이름을 찾는 방법은 정보를 보고싶은 엘리먼트에다가 마우스를 올리신 후 “Ctrl + Shift + c\"를 누르시면 개발자도구가 뜨면서 엘리먼트에 대한 정보를 볼 수 있을 꺼에요. 쿠팡에서 “크리스마스 가랜드\"로 검색해서 나오는 상품하나를 예로 들어 볼께요. 타이틀에다가 마우스 올리고 “Ctrl + Shift + c\"를 누르면 이렇게 뜹니다. 대충 설명드리면 h2 태그에 클래스 이름이 prod-buy-head__title 이네요. 이 이름을 가지고 접근하면 정보를 얻을 수 있어요. 여러가지 이름들이 있는데 이름이 유일할때는 한방에 접근할 수 있고 유일하지 않을 때는 점진적으로 찾아가서 접근해야 됩니다. 1 title = driver.find_element_by_class_name(\"prod-buy-header__title\").text 클래스명으로 엘리먼트를 찾아서 해당 요소의 텍스트 내용을 읽어오는 코드에요. 이젠 이미지를 찾아볼께요. 이미지를 찾아서 이미지의 출처를 통해 이미지를 다운받을꺼에요. 동일하게 그림에다가 마우스 올리고 단축키 누르면 개발자 도구가 뜨면서 요소의 정보가 보입니다. 근데 이놈은 “subType-IMAGE” 라는 클래스의 하위에 있는데요. 저 클래스 하위의 이미지 요소를 찾으면 제대로 찾아지지가 않아요. 왜냐하면 “subType-IMAGE” 라는 클래스는 저 페이지에서 너무 많거든요. 그래서 이미지 엘리먼트 상위의 유일하게 접근할 수 있는 요소를 찾아서 접근해 나갈꺼에요. 그 애가 바로 “detail-item\"입니다. 클래스 이름이 “detail-item” 엘리먼트 하위의 이미지를 정보를 가져오는 거죠! 1 img = driver.find_elements_by_xpath(\"//*[@class='detail-item']//img\") 클래스 이름이 “detail-item\"인 엘리먼트 하위의 이미지를 가져오고있습니다. 그리고 이미지 엘리먼트가 여러개일 수 있기 때문에 함수이름에 s가 있는거 보이시죠^^? find_elements_by_xpath() 3. 이미지 다운받기 이미지는 소스코드가 위치한 폴더에 imgs라는 폴더에 저장할꺼에요. 자동으로 만들어지게 되어있습니다. 이미지를 다운받기 위해서는 출처를 알아야되는데, 출처는 이미지 엘리먼트의 “src” 라는 속성에서 가져올 수 있습니다. 그리고 유효한 상품이미지가 가지고 있는 몇가지 패턴들이 있어요. 그런 패턴을 가지고 있지 않은 이미지들은 다운로드 하지 않도록 되어있습니다. 저장될때의 이미지 명은 랜덤으로 생성되게 되어있어요. 사용자가 하나하나 정하기로 그렇고, 정해서 하면 이름이 겹칠 확률도 높기때문에 겹칠확률이 적도록 적당히 긴 랜덤이름으로 저장되게 되어있습니다. 1 2 3 4 5 6 7 for each_img in img: src = each_img.get_attribute('src') if 'vendor_inventory' not in src and ('thumbnail' not in src or 'remote' not in src): continue fname = secrets.token_hex(16)[0:10] + \".png\" fnamefull = self.imgpath + \"\\\\\" + fname urllib.request.urlretrieve(src, fnamefull) 하.. 설명이 다 끝났네요. 길다 길어. 너무 전문적이지 않게 적당히 설명한다고는 했는데 잘 전달됐을지 모르겠네요. 코드​ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 # coding: utf-8 import hmac import hashlib import os import time import requests import json import urllib.request from selenium import webdriver import secrets from urllib.parse import urlencode from PIL import Image from io import BytesIO __author__ = \"Jaejin Jang\" class cupangMgr: def __init__(self): self.DOMAIN = \"https://api-gateway.coupang.com\" if not os.path.isdir('imgs'): os.makedirs('imgs') self.imgpath = os.getcwd() + r\"\\imgs\" self.options = webdriver.ChromeOptions() self.options.add_argument('headless') self.options.add_argument(\"user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36\") self.options.add_argument(\"lang=ko_KR\") self.webdriverpath = os.getcwd() + r\"\\chromedriver.exe\" def generateHmac(self, method, url, secretKey, accessKey): path, *query = url.split(\"?\") os.environ[\"TZ\"] = \"GMT+0\" datetime = time.strftime('%y%m%d')+'T'+time.strftime('%H%M%S')+'Z' message = datetime + method + path + (query[0] if query else \"\") signature = hmac.new(bytes(secretKey, \"utf-8\"), message.encode(\"utf-8\"), hashlib.sha256).hexdigest() return \"CEA algorithm=HmacSHA256, access-key={}, signed-date={}, signature={}\".format(accessKey, datetime, signature) def get_productsdata(self, request_method, authorization, keyword, limit): URL = \"/v2/providers/affiliate_open_api/apis/openapi/products/search?keyword=\" + urllib.parse.quote(keyword) + \"\u0026limit=\" + str(limit) url = \"{}{}\".format(self.DOMAIN, URL) response = requests.request(method=request_method, url=url, headers={ \"Authorization\": authorization, \"Content-Type\": \"application/json;charset=UTF-8\" }) retdata = json.dumps(response.json(), indent=4).encode('utf-8') jsondata = json.loads(retdata) data = jsondata['data'] productdata = data['productData'] return productdata def make_productcontent(self, each_product): driver = webdriver.Chrome(self.webdriverpath, options=self.options) time.sleep(5) producturl = each_product['productUrl'] driver.get(producturl) driver.execute_script(\"Object.defineProperty(navigator, 'plugins', {get: function() {return[1, 2, 3, 4, 5]}})\") driver.execute_script(\"Object.defineProperty(navigator, 'languages', {get: function() {return ['ko-KR', 'ko']}})\") driver.execute_script(\"const getParameter = WebGLRenderingContext.getParameter;WebGLRenderingContext.prototype.getParameter = function(parameter) {if (parameter === 37445) {return 'NVIDIA Corporation'} if (parameter === 37446) {return 'NVIDIA GeForce GTX 980 Ti OpenGL Engine';}return getParameter(parameter);};\") time.sleep(5) title = driver.find_element_by_class_name(\"prod-buy-header__title\").text img = driver.find_elements_by_xpath(\"//*[@class='detail-item']//img\") images = [] for each_img in img: src = each_img.get_attribute('src') if 'vendor_inventory' not in src and ('thumbnail' not in src or 'remote' not in src): continue fname = secrets.token_hex(16)[0:10] + \".png\" fnamefull = self.imgpath + \"\\\\\" + fname urllib.request.urlretrieve(src, fnamefull) images.append(('image', (fname, open(fnamefull, 'rb'), 'image/png'))) driver.close() return title, producturl, images if __name__ == '__main__': method = 'GET'\t#정보를 얻는것이기 때문에 GET keyword = '채워 넣으세요' #검색할 키워드, 쿠팡에서 검색하는거랑 결과가 동일합니다. limit = 5\t#몇개의 정보를 가져올지 설정. 상위부터 가져옵니다. access_key = '채워 넣으세요.'\t#API access key secret_key = '채워 넣으세요.'\t#API secret key URL = \"/v2/providers/affiliate_open_api/apis/openapi/products/search?keyword=\" + urllib.parse.quote(keyword) + \"\u0026limit=\" + str(limit) test = cupangMgr() authorization = test.generateHmac(method, URL, secret_key, access_key)\t# HMAC 생성 productdata = test.get_productsdata(method, authorization, keyword, limit)\t# API 호출 for each_product in productdata: title, producturl, images = test.make_productcontent(each_product) print('타이틀 : ', title) print('URL : ', producturl) print('이미지파일 : ', images) 실행하시면 아래그림처럼 파싱해온 결과들이 출력되고, imgs폴더에 이미지가 다운로드 된것을 확인하실수 있습니다. 궁금한 점은 질문해주세요^^ 다음 포스팅에는…\n네이버 블로그 API로 상품정보 올리는 방법방법과 ☆☆☆개꿀팁!! 리뷰 평점 가져오는 방법☆☆☆ 올려드리겠습니다. ","wordCount":"3126","inLanguage":"ko","datePublished":"2020-01-01T07:12:52+09:00","dateModified":"2020-01-01T07:12:52+09:00","author":{"@type":"Person","name":"Jaejin Jang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://jaejin0me.github.io/post/20200101/"},"publisher":{"@type":"Organization","name":"Jaejin's blog","logo":{"@type":"ImageObject","url":"https://jaejin0me.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://jaejin0me.github.io accesskey=h title="Jaejin's blog (Alt + H)">Jaejin's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://jaejin0me.github.io/ title=Home><span>Home</span></a></li><li><a href=https://jaejin0me.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://jaejin0me.github.io/post/ title=Posts><span>Posts</span></a></li><li><a href=https://jaejin0me.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://jaejin0me.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://jaejin0me.github.io/about/ title="About Me"><span>About Me</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>파이썬으로 쿠팡 파트너스 API 활용하기 - 2 상품 이미지 가져오기</h1><div class=post-meta>&lt;span title='2020-01-01 07:12:52 +0900 +0900'>1월 1, 2020&lt;/span>&amp;nbsp;·&amp;nbsp;Jaejin Jang</div></header><div class=post-content><p><em>안녕하세요.<br>저번 시간에 파트너스 API를 통해서 상품정보를 가져오는 것까지 했습니다.<br>오늘은 쿠팡에 있는 상품 이미지 가져오는 방법에 대해서 설명하겠습니다.<br>API를 호출해 가져온 상품정보에 접속할 수 있는 URL이 있었는데요.<br>그 URL를 통해 상품페이지로 접속해서 이미지를 가져올꺼에요. 오늘꺼 조금 깁니다&mldr;</em></p><h1 id=용어-대충-설명>용어 대~충 설명<a hidden class=anchor aria-hidden=true href=#용어-대충-설명>#</a></h1><ul><li>파싱 : 가져오는 것? ㅋㅋ (ex. 문자열을 파싱한다 = 문자열을 가져온다)</li></ul><h1 id=이번에-설명할-내용>이번에 설명할 내용<a hidden class=anchor aria-hidden=true href=#이번에-설명할-내용>#</a></h1><ul><li>상품URL을 타고 상품페이지에 접속해서 상품타이틀, 이미지 가져오기</li></ul><h1 id=시작하기-전에-간단히-알아야할-것들>시작하기 전에 간단히 알아야할 것들<a hidden class=anchor aria-hidden=true href=#시작하기-전에-간단히-알아야할-것들>#</a></h1><ul><li>웹페이지는 구성하는 요소에는 정적인 정보와 동적인 정보가 있습니다. 정적인 정보는 일반적인 html 태그라고 생각하시면 되고 동적인 정보는 자바스크립트가 들어가있는 부분이라고 생각하시면 돼요.</li><li>근데 이 자바스크립트는 웹브라우저에서 처리를 해주기 때문에 웹브라우저로 접속하지 않으면 처리가 안되서 정보를 가져올 수가 없습니다.</li><li>그래서 웹브라우저를 컨트롤할 수 있는 놈을 이용하는데요. 보통 &ldquo;셀레니움"을 사용합니다(저는 셀레니움밖에 몰라서 다른것도 있는지 모르겠네요 ㅎㅎ)</li><li>셀레니움이 웹브라우저를 컨트롤 하는건 아니고, 브라우저별로 웹드라이버가 있는데 그 웹드라이버를 셀레니움을 이용해서 컨트롤할 수 가 있어요 ㅎㅎ</li></ul><p><img loading=lazy src=/20200101_1.png alt="셀레니움 설명" title="셀레니움 설명"></p><ul><li>출처 : <a href=https://www.slideshare.net/JiLee24/selenium-113082253>https://www.slideshare.net/JiLee24/selenium-113082253</a></li><li>암튼 중요한 것은 웹드라이버가 필요하고 셀레니움으로 컨트롤 한다는 것입니다.</li><li>다들 크롬을 많으 쓰시니까 크롬웹드라이버를 이용할 꺼고, 셀레니움은 파이썬 셀레니움 패키지를 설치하면 됩니다.</li></ul><h2 id=크롬웹드라이버-다운>크롬웹드라이버 다운<a hidden class=anchor aria-hidden=true href=#크롬웹드라이버-다운>#</a></h2><ul><li>우선 본인이 사용하는 크롬버전을 확인하시고요.
<img loading=lazy src=/20200101_2.png alt="크롬 버전 확인" title="크롬 버전 확인"></li><li>크롬웹드라이버 사이트 <a href=https://chromedriver.chromium.org/downloads>https://chromedriver.chromium.org/downloads</a> 에 접속하셔서 받으시면 됩니다.
<img loading=lazy src=/20200101_3.png alt="크롬웹드라이버 다운" title="크롬웹드라이버 다운">
​</li></ul><h2 id=파이썬-v3-셀레니움-패키지-설치>파이썬 v3 셀레니움 패키지 설치<a hidden class=anchor aria-hidden=true href=#파이썬-v3-셀레니움-패키지-설치>#</a></h2><ul><li>파이썬은 패키지설치할때 pip를 사용합니다. 우리는 파이썬 v3 이니깐 pip3 이겠죠?ㅎㅎ</li><li>명령어 창에서 &ldquo;pip3 install selenium&rdquo; 이렇게 치시면 설치됩니다. 저는 이미 설치되어 있으니까 already ~~ 하고 나오네요.
<img loading=lazy src=/20200101_4.png alt="셀레니움 설치" title="셀레니움 설치"></li></ul><h2 id=코드의-흐름-및-간단-설명>코드의 흐름 및 간단 설명<a hidden class=anchor aria-hidden=true href=#코드의-흐름-및-간단-설명>#</a></h2><ul><li><ol><li>웹드라이버 실행</li></ol></li><li><ol start=2><li>URL로 상품페이지 접근</li></ol></li><li><ol start=3><li>타이틀, 이미지 찾기</li></ol></li><li><ol start=4><li>이미지 다운로드</li></ol></li></ul><h3 id=1-웹드라이버-실행>1. 웹드라이버 실행<a hidden class=anchor aria-hidden=true href=#1-웹드라이버-실행>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># ~~</span>
</span></span><span class=line><span class=cl>	<span class=bp>self</span><span class=o>.</span><span class=n>options</span> <span class=o>=</span> <span class=n>webdriver</span><span class=o>.</span><span class=n>ChromeOptions</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=bp>self</span><span class=o>.</span><span class=n>options</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>&#39;headless&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=bp>self</span><span class=o>.</span><span class=n>options</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=bp>self</span><span class=o>.</span><span class=n>options</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;lang=ko_KR&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=bp>self</span><span class=o>.</span><span class=n>webdriverpath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getcwd</span><span class=p>()</span> <span class=o>+</span> <span class=sa>r</span><span class=s2>&#34;\chromedriver.exe&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ~~</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>driver</span> <span class=o>=</span> <span class=n>webdriver</span><span class=o>.</span><span class=n>Chrome</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>webdriverpath</span><span class=p>,</span> <span class=n>options</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>options</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>웹드라이버를 소스코드랑 동일한 폴더에 위치해 놓으셔야 됩니다.</li><li>웹드라이버를 실행할때 다양한 옵션들을 줄수가 있습니다. 제가 제공하는 코드에는 이런저런 옵션이 있는데요.</li><li>음 그냥 크롤링(자동으로 돌아다니면서 웹페이지를 파싱하는 것) 방지를 우회하기 위해서 넣어놨다고 생각하시면 됩니다.</li><li>필요없는 옵션들도 있는데 그냥 뭐가 필요하고 안필요한지 구분하는것도 귀찮아서 우선 넣어 놨습니다.</li><li>선택가능한 옵션은 headless 입니다. 프로그램이 동작하는 걸 보고싶은 분은 삭제하시거나 주석처리해서 실행해보세요. 자동으로 웹브라우저가 떠서 동작하는 걸 보실 수 있을꺼에요.</li><li>저 옵션을 설정하는게 컴퓨터의 리소스를 적게 먹으니가 보통 설정해 놓는 편이에요^^. 개발할때에는 빼놨다가 다 끝나면 설정하는 편입니다.</li><li>중간에 sleep()이 있는데요. 실행하는데 시간이 조금 걸릴테니까 기다려주는 부분이라고 생각하시며 됩니다.</li></ul><h3 id=2-url로-상품페이지-접근>2. URL로 상품페이지 접근<a hidden class=anchor aria-hidden=true href=#2-url로-상품페이지-접근>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>	<span class=n>producturl</span> <span class=o>=</span> <span class=n>each_product</span><span class=p>[</span><span class=s1>&#39;productUrl&#39;</span><span class=p>]</span> 
</span></span><span class=line><span class=cl>	<span class=n>driver</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>producturl</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>간~단합니다. 저번시간에 키워드로 검색하는 API 써서 정보를 얻었을때 보면 &ldquo;productUrl&rdquo; 이라는 요소가 있었습니다. 그 요소에 접근해서 url을 가져오고 웹드라이버를 컨트롤 해서 접근합니다.</li></ul><h3 id=3-타이틀-이미지-element-찾기>3. 타이틀, 이미지 Element 찾기<a hidden class=anchor aria-hidden=true href=#3-타이틀-이미지-element-찾기>#</a></h3><ul><li>웹페이지에서 타이틀과 이미지 엘리먼트를 찾을꺼에요. 이 부분은 음 설명은 할텐데 이해가 안가실 수도 있어요.</li><li>궁금하신분은 개인적으로 좀더 찾아보셔야 될 것 같습니다.</li><li>웹페이지를 구성하는 엘리먼트들에는 이름들이 있어요. 그래서 그 이름을 이용해서 찾으면 됩니다.</li><li>이름을 찾는 방법은 정보를 보고싶은 엘리먼트에다가 마우스를 올리신 후 &ldquo;Ctrl + Shift + c"를 누르시면 개발자도구가 뜨면서 엘리먼트에 대한 정보를 볼 수 있을 꺼에요.</li><li>쿠팡에서 &ldquo;크리스마스 가랜드"로 검색해서 나오는 상품하나를 예로 들어 볼께요.
<img loading=lazy src=/20200101_5.png alt="크리스마스 가랜드" title="크리스마스 가랜드"></li><li>타이틀에다가 마우스 올리고 &ldquo;Ctrl + Shift + c"를 누르면 이렇게 뜹니다.</li><li>대충 설명드리면 h2 태그에 클래스 이름이 prod-buy-head__title 이네요. 이 이름을 가지고 접근하면 정보를 얻을 수 있어요.</li><li>여러가지 이름들이 있는데 이름이 유일할때는 한방에 접근할 수 있고 유일하지 않을 때는 점진적으로 찾아가서 접근해야 됩니다.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>	<span class=n>title</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_element_by_class_name</span><span class=p>(</span><span class=s2>&#34;prod-buy-header__title&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>클래스명으로 엘리먼트를 찾아서 해당 요소의 텍스트 내용을 읽어오는 코드에요.</li><li>이젠 이미지를 찾아볼께요. 이미지를 찾아서 이미지의 출처를 통해 이미지를 다운받을꺼에요.</li><li>동일하게 그림에다가 마우스 올리고 단축키 누르면 개발자 도구가 뜨면서 요소의 정보가 보입니다.
<img loading=lazy src=/20200101_6.png alt="이미지 찾기" title="이미지 찾기"></li><li>근데 이놈은 &ldquo;subType-IMAGE&rdquo; 라는 클래스의 하위에 있는데요. 저 클래스 하위의 이미지 요소를 찾으면 제대로 찾아지지가 않아요.</li><li>왜냐하면 &ldquo;subType-IMAGE&rdquo; 라는 클래스는 저 페이지에서 너무 많거든요.</li><li>그래서 이미지 엘리먼트 상위의 유일하게 접근할 수 있는 요소를 찾아서 접근해 나갈꺼에요. 그 애가 바로 &ldquo;detail-item"입니다.</li><li>클래스 이름이 &ldquo;detail-item&rdquo; 엘리먼트 하위의 이미지를 정보를 가져오는 거죠!</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>	<span class=n>img</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_elements_by_xpath</span><span class=p>(</span><span class=s2>&#34;//*[@class=&#39;detail-item&#39;]//img&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>클래스 이름이 &ldquo;detail-item"인 엘리먼트 하위의 이미지를 가져오고있습니다. 그리고 이미지 엘리먼트가 여러개일 수 있기 때문에 함수이름에 s가 있는거 보이시죠^^? find_elements_by_xpath()</li></ul><h3 id=3-이미지-다운받기>3. 이미지 다운받기<a hidden class=anchor aria-hidden=true href=#3-이미지-다운받기>#</a></h3><ul><li>이미지는 소스코드가 위치한 폴더에 imgs라는 폴더에 저장할꺼에요. 자동으로 만들어지게 되어있습니다.</li><li>이미지를 다운받기 위해서는 출처를 알아야되는데, 출처는 이미지 엘리먼트의 &ldquo;src&rdquo; 라는 속성에서 가져올 수 있습니다.</li><li>그리고 유효한 상품이미지가 가지고 있는 몇가지 패턴들이 있어요. 그런 패턴을 가지고 있지 않은 이미지들은 다운로드 하지 않도록 되어있습니다.</li><li>저장될때의 이미지 명은 랜덤으로 생성되게 되어있어요. 사용자가 하나하나 정하기로 그렇고, 정해서 하면 이름이 겹칠 확률도 높기때문에 겹칠확률이 적도록 적당히 긴 랜덤이름으로 저장되게 되어있습니다.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>	<span class=k>for</span> <span class=n>each_img</span> <span class=ow>in</span> <span class=n>img</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>src</span> <span class=o>=</span> <span class=n>each_img</span><span class=o>.</span><span class=n>get_attribute</span><span class=p>(</span><span class=s1>&#39;src&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=s1>&#39;vendor_inventory&#39;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>src</span> <span class=ow>and</span> <span class=p>(</span><span class=s1>&#39;thumbnail&#39;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>src</span> <span class=ow>or</span> <span class=s1>&#39;remote&#39;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>src</span><span class=p>):</span>
</span></span><span class=line><span class=cl>			<span class=k>continue</span>
</span></span><span class=line><span class=cl>		<span class=n>fname</span> <span class=o>=</span> <span class=n>secrets</span><span class=o>.</span><span class=n>token_hex</span><span class=p>(</span><span class=mi>16</span><span class=p>)[</span><span class=mi>0</span><span class=p>:</span><span class=mi>10</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&#34;.png&#34;</span> 
</span></span><span class=line><span class=cl>		<span class=n>fnamefull</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>imgpath</span> <span class=o>+</span> <span class=s2>&#34;</span><span class=se>\\</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=n>fname</span>
</span></span><span class=line><span class=cl>		<span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>urlretrieve</span><span class=p>(</span><span class=n>src</span><span class=p>,</span> <span class=n>fnamefull</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>하.. 설명이 다 끝났네요. 길다 길어. 너무 전문적이지 않게 적당히 설명한다고는 했는데 잘 전달됐을지 모르겠네요.</li></ul><h3 id=코드>코드​<a hidden class=anchor aria-hidden=true href=#코드>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span><span class=lnt>95
</span><span class=lnt>96
</span><span class=lnt>97
</span><span class=lnt>98
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># coding: utf-8</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hmac</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.request</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>selenium</span> <span class=kn>import</span> <span class=n>webdriver</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>secrets</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>urllib.parse</span> <span class=kn>import</span> <span class=n>urlencode</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PIL</span> <span class=kn>import</span> <span class=n>Image</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>io</span> <span class=kn>import</span> <span class=n>BytesIO</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>__author__</span> <span class=o>=</span> <span class=s2>&#34;Jaejin Jang&lt;jaejin_me@naver.com&gt;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>cupangMgr</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=bp>self</span><span class=o>.</span><span class=n>DOMAIN</span> <span class=o>=</span> <span class=s2>&#34;https://api-gateway.coupang.com&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isdir</span><span class=p>(</span><span class=s1>&#39;imgs&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>			<span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=s1>&#39;imgs&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=bp>self</span><span class=o>.</span><span class=n>imgpath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getcwd</span><span class=p>()</span> <span class=o>+</span> <span class=sa>r</span><span class=s2>&#34;\imgs&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=bp>self</span><span class=o>.</span><span class=n>options</span> <span class=o>=</span> <span class=n>webdriver</span><span class=o>.</span><span class=n>ChromeOptions</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=bp>self</span><span class=o>.</span><span class=n>options</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>&#39;headless&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=bp>self</span><span class=o>.</span><span class=n>options</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=bp>self</span><span class=o>.</span><span class=n>options</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;lang=ko_KR&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=bp>self</span><span class=o>.</span><span class=n>webdriverpath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getcwd</span><span class=p>()</span> <span class=o>+</span> <span class=sa>r</span><span class=s2>&#34;\chromedriver.exe&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>def</span> <span class=nf>generateHmac</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>secretKey</span><span class=p>,</span> <span class=n>accessKey</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=n>path</span><span class=p>,</span> <span class=o>*</span><span class=n>query</span> <span class=o>=</span> <span class=n>url</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;?&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s2>&#34;TZ&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;GMT+0&#34;</span>
</span></span><span class=line><span class=cl>		<span class=n>datetime</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%y%m</span><span class=si>%d</span><span class=s1>&#39;</span><span class=p>)</span><span class=o>+</span><span class=s1>&#39;T&#39;</span><span class=o>+</span><span class=n>time</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%H%M%S&#39;</span><span class=p>)</span><span class=o>+</span><span class=s1>&#39;Z&#39;</span>
</span></span><span class=line><span class=cl>		<span class=n>message</span> <span class=o>=</span> <span class=n>datetime</span> <span class=o>+</span> <span class=n>method</span> <span class=o>+</span> <span class=n>path</span> <span class=o>+</span> <span class=p>(</span><span class=n>query</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=k>if</span> <span class=n>query</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>signature</span> <span class=o>=</span> <span class=n>hmac</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=nb>bytes</span><span class=p>(</span><span class=n>secretKey</span><span class=p>,</span> <span class=s2>&#34;utf-8&#34;</span><span class=p>),</span> <span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>),</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s2>&#34;CEA algorithm=HmacSHA256, access-key=</span><span class=si>{}</span><span class=s2>, signed-date=</span><span class=si>{}</span><span class=s2>, signature=</span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>accessKey</span><span class=p>,</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>signature</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>def</span> <span class=nf>get_productsdata</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request_method</span><span class=p>,</span> <span class=n>authorization</span><span class=p>,</span> <span class=n>keyword</span><span class=p>,</span> <span class=n>limit</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=n>URL</span> <span class=o>=</span> <span class=s2>&#34;/v2/providers/affiliate_open_api/apis/openapi/products/search?keyword=&#34;</span> <span class=o>+</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote</span><span class=p>(</span><span class=n>keyword</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;&amp;limit=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>limit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>DOMAIN</span><span class=p>,</span> <span class=n>URL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>request</span><span class=p>(</span><span class=n>method</span><span class=o>=</span><span class=n>request_method</span><span class=p>,</span> <span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=p>{</span> <span class=s2>&#34;Authorization&#34;</span><span class=p>:</span> <span class=n>authorization</span><span class=p>,</span> <span class=s2>&#34;Content-Type&#34;</span><span class=p>:</span> <span class=s2>&#34;application/json;charset=UTF-8&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=n>retdata</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>(),</span> <span class=n>indent</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>jsondata</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>retdata</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>data</span> <span class=o>=</span> <span class=n>jsondata</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>productdata</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;productData&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>productdata</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>def</span> <span class=nf>make_productcontent</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>each_product</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=n>driver</span> <span class=o>=</span> <span class=n>webdriver</span><span class=o>.</span><span class=n>Chrome</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>webdriverpath</span><span class=p>,</span> <span class=n>options</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>options</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>producturl</span> <span class=o>=</span> <span class=n>each_product</span><span class=p>[</span><span class=s1>&#39;productUrl&#39;</span><span class=p>]</span> 
</span></span><span class=line><span class=cl>		<span class=n>driver</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>producturl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>driver</span><span class=o>.</span><span class=n>execute_script</span><span class=p>(</span><span class=s2>&#34;Object.defineProperty(navigator, &#39;plugins&#39;, {get: function() </span><span class=si>{return[1, 2, 3, 4, 5]}</span><span class=s2>})&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>driver</span><span class=o>.</span><span class=n>execute_script</span><span class=p>(</span><span class=s2>&#34;Object.defineProperty(navigator, &#39;languages&#39;, {get: function() {return [&#39;ko-KR&#39;, &#39;ko&#39;]}})&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>driver</span><span class=o>.</span><span class=n>execute_script</span><span class=p>(</span><span class=s2>&#34;const getParameter = WebGLRenderingContext.getParameter;WebGLRenderingContext.prototype.getParameter = function(parameter) {if (parameter === 37445) {return &#39;NVIDIA Corporation&#39;} if (parameter === 37446) {return &#39;NVIDIA GeForce GTX 980 Ti OpenGL Engine&#39;;}return getParameter(parameter);};&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>title</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_element_by_class_name</span><span class=p>(</span><span class=s2>&#34;prod-buy-header__title&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
</span></span><span class=line><span class=cl>		<span class=n>img</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_elements_by_xpath</span><span class=p>(</span><span class=s2>&#34;//*[@class=&#39;detail-item&#39;]//img&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>images</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>for</span> <span class=n>each_img</span> <span class=ow>in</span> <span class=n>img</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>src</span> <span class=o>=</span> <span class=n>each_img</span><span class=o>.</span><span class=n>get_attribute</span><span class=p>(</span><span class=s1>&#39;src&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=s1>&#39;vendor_inventory&#39;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>src</span> <span class=ow>and</span> <span class=p>(</span><span class=s1>&#39;thumbnail&#39;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>src</span> <span class=ow>or</span> <span class=s1>&#39;remote&#39;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>src</span><span class=p>):</span>
</span></span><span class=line><span class=cl>				<span class=k>continue</span>
</span></span><span class=line><span class=cl>			<span class=n>fname</span> <span class=o>=</span> <span class=n>secrets</span><span class=o>.</span><span class=n>token_hex</span><span class=p>(</span><span class=mi>16</span><span class=p>)[</span><span class=mi>0</span><span class=p>:</span><span class=mi>10</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&#34;.png&#34;</span> 
</span></span><span class=line><span class=cl>			<span class=n>fnamefull</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>imgpath</span> <span class=o>+</span> <span class=s2>&#34;</span><span class=se>\\</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=n>fname</span>
</span></span><span class=line><span class=cl>			<span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>urlretrieve</span><span class=p>(</span><span class=n>src</span><span class=p>,</span> <span class=n>fnamefull</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=n>images</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=s1>&#39;image&#39;</span><span class=p>,</span> <span class=p>(</span><span class=n>fname</span><span class=p>,</span> <span class=nb>open</span><span class=p>(</span><span class=n>fnamefull</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>),</span> <span class=s1>&#39;image/png&#39;</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>		<span class=n>driver</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>title</span><span class=p>,</span> <span class=n>producturl</span><span class=p>,</span> <span class=n>images</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=n>method</span> <span class=o>=</span> <span class=s1>&#39;GET&#39;</span>				 <span class=c1>#정보를 얻는것이기 때문에 GET</span>
</span></span><span class=line><span class=cl>	<span class=n>keyword</span> <span class=o>=</span> <span class=s1>&#39;채워 넣으세요&#39;</span> <span class=c1>#검색할 키워드, 쿠팡에서 검색하는거랑 결과가 동일합니다.</span>
</span></span><span class=line><span class=cl>	<span class=n>limit</span> <span class=o>=</span> <span class=mi>5</span>					 <span class=c1>#몇개의 정보를 가져올지 설정. 상위부터 가져옵니다.</span>
</span></span><span class=line><span class=cl>	<span class=n>access_key</span> <span class=o>=</span> <span class=s1>&#39;채워 넣으세요.&#39;</span>			<span class=c1>#API access key</span>
</span></span><span class=line><span class=cl>	<span class=n>secret_key</span> <span class=o>=</span> <span class=s1>&#39;채워 넣으세요.&#39;</span>		<span class=c1>#API secret key</span>
</span></span><span class=line><span class=cl>	<span class=n>URL</span> <span class=o>=</span> <span class=s2>&#34;/v2/providers/affiliate_open_api/apis/openapi/products/search?keyword=&#34;</span> <span class=o>+</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote</span><span class=p>(</span><span class=n>keyword</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;&amp;limit=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>limit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>test</span> <span class=o>=</span> <span class=n>cupangMgr</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=n>authorization</span> <span class=o>=</span> <span class=n>test</span><span class=o>.</span><span class=n>generateHmac</span><span class=p>(</span><span class=n>method</span><span class=p>,</span> <span class=n>URL</span><span class=p>,</span> <span class=n>secret_key</span><span class=p>,</span> <span class=n>access_key</span><span class=p>)</span>		<span class=c1># HMAC 생성</span>
</span></span><span class=line><span class=cl>	<span class=n>productdata</span> <span class=o>=</span> <span class=n>test</span><span class=o>.</span><span class=n>get_productsdata</span><span class=p>(</span><span class=n>method</span><span class=p>,</span> <span class=n>authorization</span><span class=p>,</span> <span class=n>keyword</span><span class=p>,</span> <span class=n>limit</span><span class=p>)</span>	<span class=c1># API 호출</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=n>each_product</span> <span class=ow>in</span> <span class=n>productdata</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>title</span><span class=p>,</span> <span class=n>producturl</span><span class=p>,</span> <span class=n>images</span> <span class=o>=</span> <span class=n>test</span><span class=o>.</span><span class=n>make_productcontent</span><span class=p>(</span><span class=n>each_product</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s1>&#39;타이틀 : &#39;</span><span class=p>,</span> <span class=n>title</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s1>&#39;URL : &#39;</span><span class=p>,</span> <span class=n>producturl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s1>&#39;이미지파일 : &#39;</span><span class=p>,</span> <span class=n>images</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>실행하시면 아래그림처럼 파싱해온 결과들이 출력되고, imgs폴더에 이미지가 다운로드 된것을 확인하실수 있습니다.</li></ul><p><img loading=lazy src=/20200101_7.png alt="실행 및 결과" title="실행 및 결과"></p><p>궁금한 점은 질문해주세요^^ 다음 포스팅에는&mldr;</p><ul><li>네이버 블로그 API로 상품정보 올리는 방법방법과</li><li>☆☆☆개꿀팁!! 리뷰 평점 가져오는 방법☆☆☆ 올려드리겠습니다.</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://jaejin0me.github.io/tags/python/>python</a></li><li><a href=https://jaejin0me.github.io/tags/%EC%BF%A0%ED%8C%A1%ED%8C%8C%ED%8A%B8%EB%84%88%EC%8A%A4/>쿠팡파트너스</a></li><li><a href=https://jaejin0me.github.io/tags/coupangpartners/>coupangpartners</a></li></ul></footer><script src=https://utteranc.es/client.js repo=jaejin0me/blog_comment issue-term=title label=comment theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>Jaejin Jang</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>