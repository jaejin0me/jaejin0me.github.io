<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>책뿌수기 - SQL 레벨업 8 - Jaejin's blog</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="Jaejin Jang"><meta name=description content="8장. SQL의 순서 - 깨어나는 절차 지향 sql은 관계 모델의 이론에 기초하고 있기 때문에 순번을 다루기 위한 기능이 없다. 하지만 레코드에 순번을 붙여 처리하는 경"><meta name=keywords content="Hugo,theme,even"><meta name=generator content="Hugo 0.100.2 with theme even"><link rel=canonical href=https://jaejin0me.github.io/post/posts181/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="책뿌수기 - SQL 레벨업 8"><meta property="og:description" content="8장. SQL의 순서 - 깨어나는 절차 지향 sql은 관계 모델의 이론에 기초하고 있기 때문에 순번을 다루기 위한 기능이 없다. 하지만 레코드에 순번을 붙여 처리하는 경"><meta property="og:type" content="article"><meta property="og:url" content="https://jaejin0me.github.io/post/posts181/"><meta property="article:section" content="post"><meta property="article:published_time" content="2019-05-28T23:49:45+09:00"><meta property="article:modified_time" content="2019-05-28T23:49:45+09:00"><meta itemprop=name content="책뿌수기 - SQL 레벨업 8"><meta itemprop=description content="8장. SQL의 순서 - 깨어나는 절차 지향 sql은 관계 모델의 이론에 기초하고 있기 때문에 순번을 다루기 위한 기능이 없다. 하지만 레코드에 순번을 붙여 처리하는 경"><meta itemprop=datePublished content="2019-05-28T23:49:45+09:00"><meta itemprop=dateModified content="2019-05-28T23:49:45+09:00"><meta itemprop=wordCount content="2259"><meta itemprop=keywords content="sql 튜닝,"><meta name=twitter:card content="summary"><meta name=twitter:title content="책뿌수기 - SQL 레벨업 8"><meta name=twitter:description content="8장. SQL의 순서 - 깨어나는 절차 지향 sql은 관계 모델의 이론에 기초하고 있기 때문에 순번을 다루기 위한 기능이 없다. 하지만 레코드에 순번을 붙여 처리하는 경"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Jaejin's blog</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a><a href=/about/><li class=mobile-menu-item>About</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Jaejin's blog</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=/about/>About</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>책뿌수기 - SQL 레벨업 8</h1><div class=post-meta><span class=post-time>2019-05-28</span><div class=post-category><a href=/categories/sql-%ED%8A%9C%EB%8B%9D/>sql 튜닝</a></div><span class=more-meta>2259 words</span>
<span class=more-meta>5 mins read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#23강-레코드에-순번-붙이기>23강. 레코드에 순번 붙이기</a><ul><li><a href=#1-기본키가-한-개의-필드일-경우>1. 기본키가 한 개의 필드일 경우</a></li><li><a href=#2-기본-키가-여러-개의-필드로-구성되는-경우>2. 기본 키가 여러 개의 필드로 구성되는 경우</a></li><li><a href=#3-그룹마다-순번을-붙이는-경우>3. 그룹마다 순번을 붙이는 경우</a></li><li><a href=#4-순번과-갱신>4. 순번과 갱신</a></li></ul></li><li><a href=#24강-레코드에-순번-붙이기-응용>24강. 레코드에 순번 붙이기 응용</a><ul><li><a href=#1-중앙값-구하기>1. 중앙값 구하기</a></li><li><a href=#2-순번을-사용한-테이블-분할>2. 순번을 사용한 테이블 분할</a></li><li><a href=#3-테이블에-존재하는-시퀀스-찾기>3. 테이블에 존재하는 시퀀스 찾기</a></li></ul></li><li><a href=#25강-시퀀스-객체-identify-필드-채번-테이블>25강. 시퀀스 객체, IDENTIFY 필드, 채번 테이블</a><ul><li><a href=#1-시퀀스-객체>1. 시퀀스 객체</a></li><li><a href=#2-identify-필드>2. IDENTIFY 필드</a></li><li><a href=#3-채번-테이블>3. 채번 테이블</a></li></ul></li></ul></nav></div></div><div class=post-content><h1 id=8장-sql의-순서---깨어나는-절차-지향>8장. SQL의 순서 - 깨어나는 절차 지향</h1><ul><li>sql은 관계 모델의 이론에 기초하고 있기 때문에 순번을 다루기 위한 기능이 없다.</li><li>하지만 레코드에 순번을 붙여 처리하는 경우가 많아 관련기능(시퀀스 객체, ID 필드, 윈도우 함수)을 추가하고 있다.</li></ul><h2 id=23강-레코드에-순번-붙이기>23강. 레코드에 순번 붙이기</h2><h3 id=1-기본키가-한-개의-필드일-경우>1. 기본키가 한 개의 필드일 경우</h3><h4 id=1-윈도우-함수로-사용>1) 윈도우 함수로 사용</h4><ul><li>ROW_NUMBER 함수를 사용</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>student_id</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>ROW_NUMBER</span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>student_id</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>Seq</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>FROM</span><span class=w> </span><span class=n>Weights</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=2-상관-서브쿼리-사용>2) 상관 서브쿼리 사용</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>student_id</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>FROM</span><span class=w> </span><span class=n>Weight</span><span class=w> </span><span class=n>W2</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>WHERE</span><span class=w> </span><span class=n>W2</span><span class=p>.</span><span class=n>student_id</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>W1</span><span class=p>.</span><span class=n>student_id</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>Seq</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=w> </span><span class=n>Weights</span><span class=w> </span><span class=n>W1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>기능은 동일하지만 1) 방법의 성능이 좋다. 스캔 횟수 1):1회, 2):2회</li></ul><h3 id=2-기본-키가-여러-개의-필드로-구성되는-경우>2. 기본 키가 여러 개의 필드로 구성되는 경우</h3><h4 id=1-윈도우-함수를-사용>1) 윈도우 함수를 사용</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>class</span><span class=p>,</span><span class=w> </span><span class=n>student_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>ROW_NUMBER</span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=n>ORBER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=k>class</span><span class=p>,</span><span class=w> </span><span class=n>stduent_id</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>Seq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=w> </span><span class=n>Weight2</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=2-상관-서브쿼리를-사용>2) 상관 서브쿼리를 사용</h4><ul><li>다중 필드 비교하기(문자, 숫자, 3개 비교도 가능)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>class</span><span class=p>,</span><span class=w> </span><span class=n>student_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>(</span><span class=k>SELECT</span><span class=w>	</span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>FROM</span><span class=w> </span><span class=n>Weight</span><span class=w> </span><span class=n>W2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>WHERE</span><span class=w> </span><span class=p>(</span><span class=n>W2</span><span class=p>.</span><span class=k>class</span><span class=p>,</span><span class=w> </span><span class=n>W2</span><span class=p>.</span><span class=n>student_id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=o>&lt;=</span><span class=w> </span><span class=p>(</span><span class=n>W1</span><span class=p>.</span><span class=k>class</span><span class=p>,</span><span class=w> </span><span class=n>W1</span><span class=p>.</span><span class=n>stduent_id</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>Seq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>FROM</span><span class=w> </span><span class=n>Weight</span><span class=w> </span><span class=n>W1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=3-그룹마다-순번을-붙이는-경우>3. 그룹마다 순번을 붙이는 경우</h3><h4 id=1-윈도우-함수를-사용-1>1) 윈도우 함수를 사용</h4><ul><li>class 필드에 PARTITION BY 적용</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>class</span><span class=p>,</span><span class=w> </span><span class=n>student_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>ROW_NUMBER</span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=p>(</span><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=k>class</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>student_id</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>Seq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=w> </span><span class=n>Weight2</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=2-상관서브쿼리를-사용>2) 상관서브쿼리를 사용</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>class</span><span class=p>,</span><span class=w> </span><span class=n>student_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>FROM</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>WHERE</span><span class=w> </span><span class=n>W2</span><span class=p>.</span><span class=k>class</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>W1</span><span class=p>.</span><span class=k>class</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>AND</span><span class=w> </span><span class=n>W2</span><span class=p>.</span><span class=n>student_id</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>W1</span><span class=p>.</span><span class=n>student_id</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>Seq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=w> </span><span class=n>Weight2</span><span class=w> </span><span class=n>W1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=4-순번과-갱신>4. 순번과 갱신</h3><h4 id=1-윈도우-함수를-사용-2>1) 윈도우 함수를 사용</h4><ul><li>셀렉트 쿼리를 SET에 넣으면 됨</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>UPDATE</span><span class=w> </span><span class=n>Weights3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SET</span><span class=w> </span><span class=n>Seq</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>Seq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=k>class</span><span class=p>,</span><span class=w> </span><span class=n>student_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>					</span><span class=n>ROW_NUMBER</span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=k>class</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>							</span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>student_id</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>Seq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>FROM</span><span class=w> </span><span class=n>Weights3</span><span class=p>)</span><span class=w> </span><span class=n>SeqTbl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>WHERE</span><span class=w> </span><span class=n>Weights3</span><span class=p>.</span><span class=k>class</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SeqTbls</span><span class=p>.</span><span class=k>class</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>AND</span><span class=w> </span><span class=n>Weights3</span><span class=p>.</span><span class=n>student_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SeqTbl</span><span class=p>.</span><span class=n>student_id</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=2-상관-서브쿼리를-사용-1>2) 상관 서브쿼리를 사용</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>UPDATE</span><span class=w> </span><span class=n>Weight3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>SET</span><span class=w> </span><span class=n>seq</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=k>FROM</span><span class=w> </span><span class=n>Weight3</span><span class=w> </span><span class=n>W2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>WHERE</span><span class=w> </span><span class=n>W2</span><span class=p>.</span><span class=k>class</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Weights3</span><span class=p>.</span><span class=k>class</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=k>AND</span><span class=w> </span><span class=n>W2</span><span class=p>.</span><span class=n>student_id</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>Weight3</span><span class=p>.</span><span class=n>student_id</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=24강-레코드에-순번-붙이기-응용>24강. 레코드에 순번 붙이기 응용</h2><h3 id=1-중앙값-구하기>1. 중앙값 구하기</h3><h4 id=1-집합-지향적-방법>1) 집합 지향적 방법</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>AVG</span><span class=p>(</span><span class=n>weight</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>W1</span><span class=p>.</span><span class=n>weight</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>FROM</span><span class=w> </span><span class=n>Weights</span><span class=w> </span><span class=n>W1</span><span class=p>,</span><span class=w> </span><span class=n>Weights</span><span class=w> </span><span class=n>W2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>W1</span><span class=p>.</span><span class=n>weight</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>HAVING</span><span class=w>	</span><span class=k>SUM</span><span class=p>(</span><span class=k>CASE</span><span class=w> </span><span class=k>WHEN</span><span class=w> </span><span class=n>W2</span><span class=p>.</span><span class=n>weight</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=n>W1</span><span class=p>.</span><span class=n>weight</span><span class=w> </span><span class=k>THEN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=mi>1</span><span class=w> </span><span class=k>ELSE</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=k>END</span><span class=p>)</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>AND</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=k>CASE</span><span class=w> </span><span class=k>WHEN</span><span class=w> </span><span class=n>W2</span><span class=p>.</span><span class=n>weight</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>W1</span><span class=p>.</span><span class=n>weight</span><span class=w> </span><span class=k>THEN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=mi>1</span><span class=w> </span><span class=k>ELSE</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=k>END</span><span class=p>)</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span><span class=p>)</span><span class=w> </span><span class=n>TMP</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>코드가 복잡하다</li><li>성능이 나쁘다. w1과 w2간에 결합이 발생</li></ul><h4 id=2-절차-지향적-방법-1---세계의-중심을-향해>2) 절차 지향적 방법 1 - 세계의 중심을 향해</h4><ul><li>sql에서 자연수의 특징을 활용하면 &lsquo;양쪽 끝부터 숫자 세기&rsquo;를 할 수 있다</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>AVG</span><span class=p>(</span><span class=n>weight</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>median</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>weight</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>ROW_NUMBER</span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>weight</span><span class=w> </span><span class=k>ASC</span><span class=p>,</span><span class=w> </span><span class=n>student_id</span><span class=w> </span><span class=k>ASC</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>hi</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>ROW_NUMBER</span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>weight</span><span class=w> </span><span class=k>DESC</span><span class=p>,</span><span class=w> </span><span class=n>student_id</span><span class=w> </span><span class=k>DESC</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>lo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>FROM</span><span class=w> </span><span class=n>Weights</span><span class=p>)</span><span class=w> </span><span class=n>TMP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>WEHRE</span><span class=w> </span><span class=n>hi</span><span class=w> </span><span class=k>IN</span><span class=p>(</span><span class=n>lo</span><span class=p>,</span><span class=w> </span><span class=n>lo</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>lo</span><span class=o>+</span><span class=mi>2</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>RANK 또는 DENSE_RANK를 사용해서는 안된다. 순위가 겹치거나 빌 수 있다.</li><li>테이블 접근 1회로 감소, 대신 정렬이 2회로 늘었다. ROW_NUMBER에서 사용하는 정렬이 오름/내림차순 2개라서 그렇다.</li></ul><h4 id=3-절차-지향적-방법-2---2빼기-1은-1>3) 절차 지향적 방법 2 - 2빼기 1은 1</h4><ul><li>성능적으로 개선하기</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>AVG</span><span class=p>(</span><span class=n>weight</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>weight</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=mi>2</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>ROW_NUMBER</span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=p>(</span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>weight</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=o>-</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>OVER</span><span class=p>()</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>diff</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>FROM</span><span class=w> </span><span class=n>Weights</span><span class=p>)</span><span class=w> </span><span class=n>TMP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>WHERE</span><span class=w> </span><span class=n>diff</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>정렬리 1회로 줄어든다. 이 방법이 SQL 표준으로 중앙값을 구하는 가장 빠른 방법이다.</li></ul><h3 id=2-순번을-사용한-테이블-분할>2. 순번을 사용한 테이블 분할</h3><ul><li>비어있는 자리 출력하기</li></ul><h4 id=1-집합-지향적-방법---집합의-경계선>1) 집합 지향적 방법 - 집합의 경계선</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=p>(</span><span class=n>N1</span><span class=p>.</span><span class=n>num</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>gap_start</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	   </span><span class=s1>&#39;~&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	   </span><span class=p>(</span><span class=k>MIN</span><span class=p>(</span><span class=n>N2</span><span class=p>.</span><span class=k>min</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>gap_end</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=w> </span><span class=nb>Number</span><span class=w> </span><span class=n>N1</span><span class=w> </span><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>Numbers</span><span class=w> </span><span class=n>N2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>ON</span><span class=w> </span><span class=n>N2</span><span class=p>.</span><span class=n>num</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>N1</span><span class=p>.</span><span class=n>num</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>N1</span><span class=p>.</span><span class=n>num</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>HAVING</span><span class=w> </span><span class=p>(</span><span class=n>N1</span><span class=p>.</span><span class=n>num</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=k>MIN</span><span class=p>(</span><span class=n>N2</span><span class=p>.</span><span class=n>num</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>코드도 간단하며 집합 지향적인 방식이라 좋다. 다만, 자기 결합을 사용해야 한다(Nested Loop).</li></ul><h4 id=2-절차-지향적-방법---다음-레코드와-비교>2) 절차 지향적 방법 - 다음 레코드와 비교</h4><ul><li>컨셉 : 현재 레코드와 다음 레코드를 비교해 차이가 1이 아니면</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>NUM</span><span class=o>+</span><span class=mi>1</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>gap_start</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	   </span><span class=s1>&#39;~&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	   </span><span class=p>(</span><span class=n>num</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>diff</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=k>As</span><span class=w> </span><span class=n>gap_end</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>num</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>MAX</span><span class=p>(</span><span class=n>num</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=n>OVER</span><span class=p>(</span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>num</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>					</span><span class=k>ROWS</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=n>FOLLOWING</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>							</span><span class=k>AND</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=n>FOLLOWING</span><span class=p>)</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>num</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>FROM</span><span class=w> </span><span class=n>numbers</span><span class=p>)</span><span class=w> </span><span class=n>TMP</span><span class=w> </span><span class=p>(</span><span class=n>num</span><span class=p>,</span><span class=w> </span><span class=n>diff</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>WHERE</span><span class=w> </span><span class=n>diff</span><span class=w> </span><span class=o>&lt;&gt;</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>테이블 접근 1회, 정렬 1회로 안정적 성능</li></ul><h3 id=3-테이블에-존재하는-시퀀스-찾기>3. 테이블에 존재하는 시퀀스 찾기</h3><ul><li>친구 또는 가족 인원수에 맞게 자리를 예약하는 경우 활용됨</li></ul><h4 id=1-집합-지향적-방법---다시-집합의-경계선>1) 집합 지향적 방법 - 다시, 집합의 경계선</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>MIN</span><span class=p>(</span><span class=n>NUM</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>low</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	   </span><span class=s1>&#39;~&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	   </span><span class=k>MAX</span><span class=p>(</span><span class=n>num</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>high</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>N1</span><span class=p>.</span><span class=n>num</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>COUNT</span><span class=p>(</span><span class=n>N2</span><span class=p>.</span><span class=n>num</span><span class=p>)</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>N1</span><span class=p>.</span><span class=n>num</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>FROM</span><span class=w> </span><span class=n>Numbers</span><span class=w> </span><span class=n>N1</span><span class=w> </span><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>Numbers</span><span class=w> </span><span class=n>N2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>ON</span><span class=w> </span><span class=n>N2</span><span class=p>.</span><span class=n>num</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>N1</span><span class=p>.</span><span class=n>num</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>N1</span><span class=p>.</span><span class=n>num</span><span class=p>)</span><span class=w> </span><span class=n>N</span><span class=p>(</span><span class=n>num</span><span class=p>,</span><span class=w> </span><span class=n>gp</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>gp</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=2-집합-지향적-방법---다시-다음-레코드-하나와-비교>2) 집합 지향적 방법 - 다시, 다음 레코드 하나와 비교</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>low</span><span class=p>,</span><span class=w> </span><span class=n>high</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>low</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>CASE</span><span class=w> </span><span class=k>WHEN</span><span class=w> </span><span class=n>high</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=k>NULL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=k>THEN</span><span class=w> </span><span class=k>MIN</span><span class=p>(</span><span class=n>high</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>					</span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>seq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>						</span><span class=k>ROW</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=k>CURRENT</span><span class=w> </span><span class=k>ROW</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>							</span><span class=k>AND</span><span class=w> </span><span class=n>UNBOUNDED</span><span class=w> </span><span class=n>FOLLOWING</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>				</span><span class=k>ELSE</span><span class=w> </span><span class=n>high</span><span class=w> </span><span class=k>END</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>high</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=k>CASE</span><span class=w> </span><span class=k>WHEN</span><span class=w> </span><span class=n>COALESCE</span><span class=p>(</span><span class=n>prev_diff</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&gt;</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>						</span><span class=k>THEN</span><span class=w> </span><span class=n>num</span><span class=w> </span><span class=k>ELSE</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>END</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>low</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>					</span><span class=k>CASE</span><span class=w> </span><span class=k>WHEN</span><span class=w> </span><span class=n>COALESCE</span><span class=p>(</span><span class=n>next_diff</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&gt;</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>						</span><span class=k>THEN</span><span class=w> </span><span class=n>num</span><span class=w> </span><span class=k>ELSE</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>END</span><span class=w> </span><span class=k>As</span><span class=w> </span><span class=n>high</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>					</span><span class=n>seq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>num</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>						</span><span class=k>MAX</span><span class=p>(</span><span class=n>num</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>						</span><span class=n>OVER</span><span class=p>(</span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>num</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>								</span><span class=k>ROWS</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=n>FOLLOWING</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>									</span><span class=k>AND</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=n>FOLLOWING</span><span class=p>)</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>num</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>next_diff</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>						</span><span class=n>num</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=k>MAX</span><span class=p>(</span><span class=n>num</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>							</span><span class=n>OVER</span><span class=p>(</span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>num</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>									</span><span class=k>ROWS</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=n>PRECEDING</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>										</span><span class=k>AND</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=n>PRECEDING</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>prev_diff</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>						</span><span class=n>ROW_NUMBER</span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>num</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>seq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>					</span><span class=k>FROM</span><span class=w> </span><span class=n>Numbers</span><span class=p>)</span><span class=w> </span><span class=n>TMP1</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=n>TMP2</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=n>TMP3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>low</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=25강-시퀀스-객체-identify-필드-채번-테이블>25강. 시퀀스 객체, IDENTIFY 필드, 채번 테이블</h2><ul><li>표준 SQL에는 순번을 다루는 기능으로 시퀀셜 객체나 IDENTIFY 필드가 존재한다. 하지만 사용하는 것을 권장하지는 않고, 사용한다면 시퀀스 객체를 권한다.</li></ul><h3 id=1-시퀀스-객체>1. 시퀀스 객체</h3><ul><li>테이블 또는 뷰처럼 스키마 내부에 존재하는 객체 중 하나</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=n>SEQUENCE</span><span class=w> </span><span class=n>testseq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>START</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INCREMENT</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>MAXVALUE</span><span class=w> </span><span class=mi>10000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>MINVALUE</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CYCLE</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>INSERT 구문에서 흔히 사용된다.</li></ul><h4 id=1-시퀀스-객체의-문제점>1) 시퀀스 객체의 문제점</h4><ul><li>표준화가 늦어서, 구현에 따라 구문이 달라 이식성이 없고, 사용할 수 없는 구현도 있다</li><li>시스템에서 자동으로 생성되는 값이므로 실제 엔티티 속성이 아니다.</li><li>성능적인 문제를 일으킨다</li></ul><h4 id=2-시퀀스-객체로-발생하는-성능-문제>2) 시퀀스 객체로 발생하는 성능 문제</h4><ul><li>순서성(순번의 대소 관계가 유지됨), 유일성, 연속성</li><li>사용자 A가 시퀀스 객체에서 NEXT VALUE를 검색할 때의 처리</li></ul><ol><li>시퀀스 기개체에 배타 락을 적용</li><li>NEXT VALUEfmf rjator</li><li>CURRENT VALUE를 1만큼 증가</li><li>시퀀스 객체에 배타 락을 해제</li></ol><h4 id=3-시퀀스-객체로-발생하는-성능-문제의-대처>3) 시퀀스 객체로 발생하는 성능 문제의 대처</h4><h5 id=1-cache>(1) CACHE</h5><ol><li>읽어들일 변수를 메모리에 설정하는 것, 다만 시스템 장애시 정상동작을 담보할 수 없다.</li></ol><h5 id=1-noorder>(1) NOORDER</h5><ol><li>순서성을 담보하지 않음으로써 오버 헤드를 줄인다.</li></ol><h4 id=4-순번을-키로-사용할-때의-성능-문제>4) 순번을 키로 사용할 때의 성능 문제</h4><ul><li>Hot spot 과 관련된 문제임</li><li>DBMS는 비슷한 데이털르 연속적으로 INSERT하면 물리적으로 같은 영역에 저장한다. 이 때 특정 물리적 블록에만 I/O 부하가 커지므로 성능 악화가 발생 = Hot spot, Hot block</li><li>시퀀스 객체를 사용해 INSERT를 반복하는 경우 발생하고, 대처가 불가능</li></ul><h4 id=5-순번을-키로-사용할-때의-성능-문제에-대처>5) 순번을 키로 사용할 때의 성능 문제에 대처</h4><h5 id=1-oracle의-열-키-인덱스>(1) Oracle의 열 키 인덱스</h5><ul><li>연속된 값을 도입하는 경우라도 DBMS 내부에서 변화를 주어 제대로 분산할 수 있는 구조를 사용하는 것, 다만 SELECT 성능이 나빠질 수 있다.</li></ul><h5 id=2-인덱스에-복잡한-필드를-추가해서-데이터의-분산도를-높인다>(2) 인덱스에 복잡한 필드를 추가해서 데이터의 분산도를 높인다.</h5><ul><li>논리적으로 좋은 설계가 아님</li></ul><h3 id=2-identify-필드>2. IDENTIFY 필드</h3><ul><li>&lsquo;자동 순번 필드&rsquo;라고도 한다. 테이블의 필드로 정의하고, INSERT 발생할때마다 자동을 순번을 붙여주는 기능이다.</li><li>시퀀스 객체에 비해 단점이 많다.</li><li>시퀀스 객체는 여러 테이블에서 사용가능하지만, IDENTIFY 필드는 특정 테이블에 국한된다.</li><li>CACHE, NOORDER를 지정할 수도 없다.</li><li>이점이 거의 없다.</li></ul><h3 id=3-채번-테이블>3. 채번 테이블</h3><ul><li>순번을 부여하기 위해 어플리케이션에서 채번 테이블이라는 것을 만들어 사용했었다.</li><li>구시대 유물이며 문제가 안생기기를 바라는 것이 최선(튜닝할 방법도 없다)</li></ul></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>Jaejin Jang</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2019-05-28</span></p><p class=copyright-item><span class=item-title>License</span>
<span class=item-content>Jaejin Jang</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/sql-%ED%8A%9C%EB%8B%9D/>sql 튜닝</a></div><nav class=post-nav><a class=prev href=/post/posts182/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">책뿌숴짐 - SQL 레벨업 9</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/post/posts180/><span class="next-text nav-default">블로그 리뉴얼 사항</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><script src=https://utteranc.es/client.js repo=jaejin0me/jaejin0me.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:jaejin0me@gmail.com class="iconfont icon-email" title=email></a>
<a href=https://ko-kr.facebook.com/people/%EC%9E%A5%EC%9E%AC%EC%A7%84/100005230447628 class="iconfont icon-facebook" title=facebook></a>
<a href=https://www.linkedin.com/in/jaejin0me class="iconfont icon-linkedin" title=linkedin></a>
<a href=https://github.com/jaejin0me class="iconfont icon-github" title=github></a>
<a href=https://jaejin0me.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2017 -
2022<span class=heart><i class="iconfont icon-heart"></i></span><span>Jaejin Jang</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.191509a5c8442abdb6eb5020a332fd59bdd83a7e78a2d2241108df9113504292.js></script>
<script type=text/javascript>window.MathJax={tex:{}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-111561979-1','auto'),ga('set','anonymizeIp',!0),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>