<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>책뿌숴짐 - SQL 레벨업 9 - Jaejin&#39;s blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Jaejin Jang" /><meta name="description" content="9장. 갱신과 데이터 모델 - 망치와 못 26강. 갱신을 효율적으로 갱신을 효율적으로 수행하는 SQL을 케이스 스터디 1. NULL 채우기 1 2 3 4 5 6 7 8 9 UPDATE OmitTbl SET val = (SELECT" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.55.6 with even 4.0.0" />


<link rel="canonical" href="https://jaejin0me.github.io/post/posts182/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="책뿌숴짐 - SQL 레벨업 9" />
<meta property="og:description" content="9장. 갱신과 데이터 모델 - 망치와 못 26강. 갱신을 효율적으로 갱신을 효율적으로 수행하는 SQL을 케이스 스터디 1. NULL 채우기 1 2 3 4 5 6 7 8 9 UPDATE OmitTbl SET val = (SELECT" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jaejin0me.github.io/post/posts182/" />
<meta property="article:published_time" content="2019-05-29T01:39:17&#43;09:00"/>
<meta property="article:modified_time" content="2019-05-29T01:39:17&#43;09:00"/>

<meta itemprop="name" content="책뿌숴짐 - SQL 레벨업 9">
<meta itemprop="description" content="9장. 갱신과 데이터 모델 - 망치와 못 26강. 갱신을 효율적으로 갱신을 효율적으로 수행하는 SQL을 케이스 스터디 1. NULL 채우기 1 2 3 4 5 6 7 8 9 UPDATE OmitTbl SET val = (SELECT">


<meta itemprop="datePublished" content="2019-05-29T01:39:17&#43;09:00" />
<meta itemprop="dateModified" content="2019-05-29T01:39:17&#43;09:00" />
<meta itemprop="wordCount" content="3724">



<meta itemprop="keywords" content="sql 튜닝," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="책뿌숴짐 - SQL 레벨업 9"/>
<meta name="twitter:description" content="9장. 갱신과 데이터 모델 - 망치와 못 26강. 갱신을 효율적으로 갱신을 효율적으로 수행하는 SQL을 케이스 스터디 1. NULL 채우기 1 2 3 4 5 6 7 8 9 UPDATE OmitTbl SET val = (SELECT"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Jaejin&#39;s blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Jaejin&#39;s blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">책뿌숴짐 - SQL 레벨업 9</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-05-29 </span>
        <div class="post-category">
            <a href="/categories/sql-%ED%8A%9C%EB%8B%9D/"> sql 튜닝 </a>
            </div>
          <span class="more-meta"> 3724 words </span>
          <span class="more-meta"> 8 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li><a href="#9장-갱신과-데이터-모델-망치와-못">9장. 갱신과 데이터 모델 - 망치와 못</a>
<ul>
<li><a href="#26강-갱신을-효율적으로">26강. 갱신을 효율적으로</a>
<ul>
<li><a href="#1-null-채우기">1. NULL 채우기</a></li>
<li><a href="#2-반대로-null을-설정">2. 반대로 NULL을 설정</a></li>
</ul></li>
<li><a href="#27강-레코드에서-필드로의-갱신">27강. 레코드에서 필드로의 갱신</a>
<ul>
<li><a href="#1-필드를-하나씩-갱신">1. 필드를 하나씩 갱신</a></li>
<li><a href="#2-다중-필드-할당">2. 다중 필드 할당</a>
<ul>
<li><a href="#1-다중-필드-할당">1) 다중 필드 할당</a></li>
<li><a href="#2-스칼라-서브쿼리">2) 스칼라 서브쿼리</a></li>
</ul></li>
<li><a href="#3-not-null-제약이-걸려있는-경">3. NOT NULL 제약이 걸려있는 경</a>
<ul>
<li><a href="#1-update-구문-사용">1) UPDATE 구문 사용</a></li>
<li><a href="#2-merge-구문-사용">2) MERGE 구문 사용</a></li>
</ul></li>
</ul></li>
<li><a href="#28강-필드에서-레코드로-변경">28강. 필드에서 레코드로 변경</a></li>
<li><a href="#29강-같은-테이블의-다른-레코드로-갱신">29강. 같은 테이블의 다른 레코드로 갱신</a>
<ul>
<li><a href="#1-상관-서브쿼리-사용">1. 상관 서브쿼리 사용</a></li>
<li><a href="#2-윈도우-함수-적용">2. 윈도우 함수 적용</a></li>
<li><a href="#3-insert와-update-어떤-것이-좋을까">3. INSERT와 UPDATE 어떤 것이 좋을까?</a></li>
</ul></li>
<li><a href="#30강-갱신이-초래하는-트레이드오프">30강. 갱신이 초래하는 트레이드오프</a>
<ul>
<li><a href="#1-sql을-사용하는-방법">1. SQL을 사용하는 방법</a></li>
<li><a href="#2-모델-갱신을-사용하는-방법">2. 모델 갱신을 사용하는 방법</a></li>
</ul></li>
<li><a href="#31강-모델-갱신의-주의점">31강. 모델 갱신의 주의점</a>
<ul>
<li><a href="#1-높아지는-갱신-비용">1. 높아지는 갱신 비용</a></li>
<li><a href="#2-갱신까지의-시간-랙-발생">2. 갱신까지의 시간 랙 발생</a></li>
<li><a href="#3-모델-갱신-비용-발생">3. 모델 갱신 비용 발생</a></li>
</ul></li>
<li><a href="#32강-시야-협착-관련-문제">32강. 시야 협착 : 관련 문제</a>
<ul>
<li><a href="#1-다시-sql을-사용한다면">1. 다시 SQL을 사용한다면</a></li>
<li><a href="#2-다시-모델-갱신을-사용한다면">2. 다시 모델 갱신을 사용한다면</a></li>
<li><a href="#3-초보자보다-중급자가-경계해야">3. 초보자보다 중급자가 경계해야</a></li>
</ul></li>
<li><a href="#33강-데이터-모델을-지배하는-자가-시스템을-지배한다">33강. 데이터 모델을 지배하는 자가 시스템을 지배한다.</a></li>
<li><a href="#34강-인덱스와-b-tree">34강. 인덱스와 B-tree</a>
<ul>
<li><a href="#1-만능형-b-tree">1. 만능형 : B-tree</a></li>
<li><a href="#2-기타-인덱스">2. 기타 인덱스</a></li>
</ul></li>
<li><a href="#35강-인덱스를-잘-활용하려면">35강. 인덱스를 잘 활용하려면</a>
<ul>
<li><a href="#1-카디널리티-값의-균형-와-선택률-전체중에서-몇개가-선택되는지">1. 카디널리티(값의 균형)와 선택률(전체중에서 몇개가 선택되는지)</a></li>
<li><a href="#2-인덱스를-사용하는-것이-좋은지-판단하려면">2. 인덱스를 사용하는 것이 좋은지 판단하려면</a></li>
</ul></li>
<li><a href="#36강-인덱스로-성능-향상이-어려운-경우">36강. 인덱스로 성능 향상이 어려운 경우</a>
<ul>
<li><a href="#1-압축-조건이-존재하지-않음">1. 압축 조건이 존재하지 않음</a></li>
<li><a href="#2-레코드를-제대로-압축하지-못하는-경우">2. 레코드를 제대로 압축하지 못하는 경우</a>
<ul>
<li><a href="#1-입력-매개변수에-따라-선택률이-변동하는-경우-1">1) 입력 매개변수에 따라 선택률이 변동하는 경우 - 1</a></li>
<li><a href="#2-입력-매개변수에-따라-선택률이-변동하는-경우-2">2) 입력 매개변수에 따라 선택률이 변동하는 경우 - 2</a></li>
</ul></li>
<li><a href="#3-인덱스를-사용하지-않는-검색-조건">3. 인덱스를 사용하지 않는 검색 조건</a>
<ul>
<li><a href="#1-중간-일치-후방-일치-like-연산자">1) 중간 일치, 후방 일치 LIKE 연산자</a></li>
<li><a href="#2-색인-필드로-연산하는-경우-함수를-적요하는-경우에도-안됨">2) 색인 필드로 연산하는 경우(함수를 적요하는 경우에도 안됨)</a></li>
<li><a href="#3-is-null을-사용하는-경우">3) IS NULL을 사용하는 경우</a></li>
<li><a href="#4-부정형을-사용하는-경우">4) 부정형을 사용하는 경우</a></li>
</ul></li>
</ul></li>
<li><a href="#37강-인덱스를-사용할-수-없는-경우-대처법">37강. 인덱스를 사용할 수 없는 경우 대처법</a>
<ul>
<li><a href="#1-외부-설정으로-처리-깊고-어두운-강-건너기">1. 외부 설정으로 처리 - 깊고 어두운 강 건너기</a>
<ul>
<li><a href="#1-ui-설계로-처리">1) UI 설계로 처리</a></li>
</ul></li>
<li><a href="#2-외부-설정을-사용한-대처-방법의-주의점">2. 외부 설정을 사용한 대처 방법의 주의점</a></li>
<li><a href="#3-데이터-맡로-대처">3. 데이터 맡로 대처</a></li>
<li><a href="#4-데이터-마트를-채택할-시-주의점">4. 데이터 마트를 채택할 시 주의점</a>
<ul>
<li><a href="#1-데이터-신선도">1) 데이터 신선도</a></li>
<li><a href="#2-데이터-마트-크기">2) 데이터 마트 크기</a></li>
<li><a href="#3-데이터-마트수">3) 데이터 마트수</a></li>
<li><a href="#4-배치-윈도우">4) 배치 윈도우</a></li>
</ul></li>
<li><a href="#5-인덱스-온리-스캔으로-대처">5. 인덱스 온리 스캔으로 대처</a></li>
<li><a href="#6-인덱스-온리-스캔의-주의사항">6. 인덱스 온리 스캔의 주의사항</a>
<ul>
<li><a href="#1-dbms에-따라-사용할-수-없는-경우도-있다">1) DBMS에 따라 사용할 수 없는 경우도 있다.</a></li>
<li><a href="#2-한-개의-인덱스에-포함할-수-있는-필드-수에-제한이-있다">2) 한 개의 인덱스에 포함할 수 있는 필드 수에 제한이 있다.</a></li>
<li><a href="#3-갱신-오버-헤드가-커진다">3) 갱신 오버 헤드가 커진다.</a></li>
<li><a href="#4-정기적인-인덱스-리빌드가-필요">4) 정기적인 인덱스 리빌드가 필요</a></li>
<li><a href="#5-sql에-새로운-필드가-추가되면-사용할-수-없다">5) SQL에 새로운 필드가 추가되면 사용할 수 없다.</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</div>
    <div class="post-content">
      

<h1 id="9장-갱신과-데이터-모델-망치와-못">9장. 갱신과 데이터 모델 - 망치와 못</h1>

<h2 id="26강-갱신을-효율적으로">26강. 갱신을 효율적으로</h2>

<ul>
<li>갱신을 효율적으로 수행하는 SQL을 케이스 스터디</li>
</ul>

<h3 id="1-null-채우기">1. NULL 채우기</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">UPDATE</span> <span class="n">OmitTbl</span>
	<span class="k">SET</span> <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">val</span>
		<span class="k">FROM</span> <span class="n">OmitTbl</span>	<span class="n">OT1</span>
		<span class="k">WHERE</span> <span class="n">OT1</span><span class="p">.</span><span class="n">keycol</span> <span class="o">=</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
		<span class="k">FROM</span> <span class="n">OmitTbl</span> <span class="n">OT2</span>
		<span class="k">WHERE</span> <span class="n">OT2</span><span class="p">.</span><span class="n">keycol</span> <span class="o">=</span> <span class="n">OmitTbl</span><span class="p">.</span><span class="n">keycol</span>
		<span class="k">AND</span> <span class="n">OT2</span><span class="p">.</span><span class="n">seq</span> <span class="o">&lt;</span> <span class="n">OmitTbl</span><span class="p">.</span><span class="n">seq</span>
		<span class="k">AND</span> <span class="n">OT2</span><span class="p">.</span><span class="n">val</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">))</span>
<span class="k">WHERE</span> <span class="n">val</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="2-반대로-null을-설정">2. 반대로 NULL을 설정</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">UPDATE</span> <span class="n">OmitTbl</span>
	<span class="k">SET</span> <span class="n">val</span> <span class="o">=</span> <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">val</span>
		<span class="o">=</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">val</span>
		<span class="k">FROM</span> <span class="n">OmitTbl</span> <span class="mi">01</span>
		<span class="k">WHERE</span> <span class="mi">01</span><span class="p">.</span><span class="n">keycol</span> <span class="o">=</span> <span class="n">OmitTbl</span><span class="p">.</span><span class="n">keycol</span>
		<span class="k">AND</span> <span class="mi">01</span><span class="p">.</span><span class="n">seq</span>
		<span class="o">=</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
		<span class="k">FROM</span> <span class="n">OmitTbl</span> <span class="mi">02</span>
		<span class="k">WHERE</span> <span class="mi">02</span><span class="p">.</span><span class="n">keycol</span> <span class="o">=</span> <span class="n">OmitTbl</span><span class="p">.</span><span class="n">keycol</span>
		<span class="k">AND</span> <span class="mi">02</span><span class="p">.</span><span class="n">seq</span> <span class="o">&lt;</span> <span class="n">OmitTbl</span><span class="p">.</span><span class="n">seq</span><span class="p">))</span>
 	<span class="k">THEN</span> <span class="k">NULL</span>
 	<span class="k">ELSE</span> <span class="n">val</span> <span class="k">END</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>
<h2 id="27강-레코드에서-필드로의-갱신">27강. 레코드에서 필드로의 갱신</h2>

<h3 id="1-필드를-하나씩-갱신">1. 필드를 하나씩 갱신</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">UPDATE</span> <span class="n">ScoreCols</span>
	<span class="k">SET</span> <span class="n">score_en</span> <span class="o">=</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">score</span>
		<span class="k">FROM</span> <span class="n">ScoreRow</span> <span class="n">SR</span>
		<span class="k">WHERE</span> <span class="n">SR</span><span class="p">.</span><span class="n">studend_id</span> <span class="o">=</span> <span class="n">ScoreCols</span><span class="p">.</span><span class="n">studend_id</span>
		<span class="k">AND</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;영어&#39;</span><span class="p">),</span>
		<span class="n">score_nl</span> <span class="o">=</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">score</span>
		<span class="k">FROM</span> <span class="n">ScoreRow</span> <span class="n">SR</span>
		<span class="k">WHERE</span> <span class="n">SR</span><span class="p">.</span><span class="n">studend_id</span> <span class="o">=</span> <span class="n">ScoreCols</span><span class="p">.</span><span class="n">studend_id</span>
		<span class="k">AND</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;국어&#39;</span><span class="p">),</span>
		<span class="n">score_mt</span> <span class="o">=</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">score</span>
		<span class="k">FROM</span> <span class="n">ScoreRow</span> <span class="n">SR</span>
		<span class="k">WHERE</span> <span class="n">SR</span><span class="p">.</span><span class="n">studend_id</span> <span class="o">=</span> <span class="n">ScoreCols</span><span class="p">.</span><span class="n">studend_id</span>
		<span class="k">AND</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;수학&#39;</span><span class="p">);</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>명확하지만 항목별로 서브쿼리를 필요로하기 때문에 비효율적이다.</li>
</ul>

<h3 id="2-다중-필드-할당">2. 다중 필드 할당</h3>

<ul>
<li>여러 개의 필드를 리스트화하고 한번에 갱신</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">UPDATE</span> <span class="n">ScoreCols</span>
	<span class="k">SET</span> <span class="p">(</span><span class="n">score_en</span><span class="p">,</span> <span class="n">score_nl</span><span class="p">,</span> <span class="n">score_mt</span><span class="p">)</span>
		<span class="o">=</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;영어&#39;</span>
				<span class="k">THEN</span> <span class="n">score</span>
				<span class="k">ELSE</span> <span class="k">NULL</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="n">score_en</span><span class="p">,</span>
				<span class="k">MAX</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;국어&#39;</span>
				<span class="k">THEN</span> <span class="n">score</span>
				<span class="k">ELSE</span> <span class="k">NULL</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="n">score_nl</span><span class="p">,</span>
				<span class="k">MAX</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;수학&#39;</span>
				<span class="k">THEN</span> <span class="n">score</span>
				<span class="k">ELSE</span> <span class="k">NULL</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="n">score_mt</span>
		<span class="k">FROM</span> <span class="n">ScoreRows</span> <span class="n">SR</span>
<span class="k">WHERE</span> <span class="n">SR</span><span class="p">.</span><span class="n">student_id</span> <span class="o">=</span> <span class="n">ScoreCols</span><span class="p">.</span><span class="n">student_id</span><span class="p">);</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>상관 서브쿼리가 하나로 정리된 대신, ScoreRows 테이블에 대한 접근이 INDEX UNIQUE SCAN -&gt; INDEX RANGE SCAN, MAX 함수의 정렬리 추가되므로 트레이드오프가 있다.</li>
</ul>

<h4 id="1-다중-필드-할당">1) 다중 필드 할당</h4>

<h4 id="2-스칼라-서브쿼리">2) 스칼라 서브쿼리</h4>

<ul>
<li>MAX함수를 적용해 집약시킴으로써 가능해진다.</li>
</ul>

<h3 id="3-not-null-제약이-걸려있는-경">3. NOT NULL 제약이 걸려있는 경</h3>

<h4 id="1-update-구문-사용">1) UPDATE 구문 사용</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">UPDATE</span> <span class="n">ScoreColsNN</span>
	<span class="k">SET</span> <span class="n">score_en</span> <span class="o">=</span> <span class="n">COALESCE</span><span class="p">((</span><span class="k">SELECT</span> <span class="n">score</span>
		<span class="k">FROM</span> <span class="n">ScoreRow</span> <span class="n">SR</span>
		<span class="k">WHERE</span> <span class="n">SR</span><span class="p">.</span><span class="n">studend_id</span> <span class="o">=</span> <span class="n">ScoreCols</span><span class="p">.</span><span class="n">studend_id</span>
		<span class="k">AND</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;영어&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
		<span class="n">score_nl</span> <span class="o">=</span> <span class="n">COALESCE</span><span class="p">((</span><span class="k">SELECT</span> <span class="n">score</span>
		<span class="k">FROM</span> <span class="n">ScoreRow</span> <span class="n">SR</span>
		<span class="k">WHERE</span> <span class="n">SR</span><span class="p">.</span><span class="n">studend_id</span> <span class="o">=</span> <span class="n">ScoreCols</span><span class="p">.</span><span class="n">studend_id</span>
		<span class="k">AND</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;국어&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
		<span class="n">score_mt</span> <span class="o">=</span> <span class="n">COALESCE</span><span class="p">((</span><span class="k">SELECT</span> <span class="n">score</span>
		<span class="k">FROM</span> <span class="n">ScoreRow</span> <span class="n">SR</span>
		<span class="k">WHERE</span> <span class="n">SR</span><span class="p">.</span><span class="n">studend_id</span> <span class="o">=</span> <span class="n">ScoreCols</span><span class="p">.</span><span class="n">studend_id</span>
		<span class="k">AND</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;수학&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">WHERE</span> <span class="k">EXISTS</span> <span class="p">(</span><span class="k">SELECT</span> <span class="o">*</span>
			<span class="k">FROM</span> <span class="n">ScoreRows</span>
			<span class="k">WHERE</span> <span class="n">student_id</span> <span class="o">=</span> <span class="n">ScoreColsNN</span><span class="p">.</span><span class="n">studend_id</span><span class="p">);</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>테이블 사이에 일치하지 않는 레코드는 제거</li>
<li>학생은 존재하지만 과목이 없는 경우 처리</li>
</ul>

<h4 id="2-merge-구문-사용">2) MERGE 구문 사용</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">MERGE</span> <span class="k">INTO</span> <span class="n">ScoreColsNN</span>
	<span class="k">USING</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">student_id</span><span class="p">,</span>
		<span class="n">COALESCE</span><span class="p">(</span><span class="k">MAX</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;영어&#39;</span>
				<span class="k">THEN</span> <span class="n">score</span>
				<span class="k">ELSE</span> <span class="k">NULL</span> <span class="k">END</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="k">AS</span> <span class="n">Score_en</span><span class="p">,</span>
		<span class="n">COALESCE</span><span class="p">(</span><span class="k">MAX</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;국어&#39;</span>
				<span class="k">THEN</span> <span class="n">score</span>
				<span class="k">ELSE</span> <span class="k">NULL</span> <span class="k">END</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="k">AS</span> <span class="n">Score_nl</span><span class="p">,</span>
		<span class="n">COALESCE</span><span class="p">(</span><span class="k">MAX</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;수학&#39;</span>
				<span class="k">THEN</span> <span class="n">score</span>
				<span class="k">ELSE</span> <span class="k">NULL</span> <span class="k">END</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="k">AS</span> <span class="n">Score_mt</span>
			<span class="k">FROM</span> <span class="n">ScoreRows</span>
			<span class="k">GROUP</span> <span class="k">By</span> <span class="n">studend_id</span><span class="p">)</span> <span class="n">SR</span>
			<span class="k">ON</span>	<span class="p">(</span><span class="n">ScoreColsNN</span><span class="p">.</span><span class="n">student_id</span> <span class="o">=</span> <span class="n">SR</span><span class="p">.</span><span class="n">student_id</span><span class="p">)</span>
	<span class="k">WHEN</span> <span class="n">MATCHED</span> <span class="k">THEN</span>
	<span class="k">UPDATE</span> <span class="k">SET</span> <span class="n">ScoreColsNN</span><span class="p">.</span><span class="n">score_en</span> <span class="o">=</span> <span class="n">SR</span><span class="p">.</span><span class="n">score_en</span><span class="p">,</span>
			<span class="n">coreColsNN</span><span class="p">.</span><span class="n">score_nl</span> <span class="o">=</span> <span class="n">SR</span><span class="p">.</span><span class="n">score_nl</span><span class="p">,</span>
			<span class="n">ScoreColsNN</span><span class="p">.</span><span class="n">score_mt</span> <span class="o">=</span> <span class="n">SR</span><span class="p">.</span><span class="n">score_mt</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>결합조건을 ON 구 하나에 묶을 수 있다.</li>
<li>ScoreRows 테이블 풀 스캔 1회 + 정렬 1회로 고정된다.</li>
<li>나은 선택지로 고려해볼만 하다.</li>
</ul>

<h2 id="28강-필드에서-레코드로-변경">28강. 필드에서 레코드로 변경</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">UPDATE</span> <span class="n">ScoreRows</span>
	<span class="k">SET</span> <span class="n">Score</span> <span class="o">=</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">CASE</span> <span class="n">ScoreRows</span><span class="p">.</span><span class="n">subject</span>
		<span class="k">WHEN</span> <span class="s1">&#39;영어&#39;</span> <span class="k">THEN</span> <span class="n">score_en</span>
		<span class="k">WHEN</span> <span class="s1">&#39;국어&#39;</span> <span class="k">THEN</span> <span class="n">score_nl</span>
		<span class="k">WHEN</span> <span class="s1">&#39;수학&#39;</span> <span class="k">THEN</span> <span class="n">score_nt</span>
		<span class="k">ELSE</span> <span class="k">NULL</span>
		<span class="k">END</span>
	<span class="k">FROM</span> <span class="n">ScoreCols</span>
	<span class="k">WHERE</span> <span class="n">student_id</span> <span class="o">=</span> <span class="n">ScoreRow</span><span class="p">.</span><span class="n">student_id</span><span class="p">);</span></code></pre></td></tr></table>
</div>
</div>
<h2 id="29강-같은-테이블의-다른-레코드로-갱신">29강. 같은 테이블의 다른 레코드로 갱신</h2>

<h3 id="1-상관-서브쿼리-사용">1. 상관 서브쿼리 사용</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Stocks2</span>
<span class="k">SELECT</span> <span class="n">brand</span><span class="p">,</span> <span class="n">sale_date</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span>
	<span class="k">CASE</span> <span class="n">SIGN</span><span class="p">(</span><span class="n">price</span> <span class="o">-</span>
			<span class="p">(</span><span class="k">SELECT</span> <span class="n">price</span>
			<span class="k">FROM</span> <span class="n">Stocks</span> <span class="n">S1</span>
			<span class="k">WHERE</span> <span class="n">brand</span> <span class="o">=</span> <span class="n">Stocks</span><span class="p">.</span><span class="n">brand</span>
			<span class="k">AND</span> <span class="n">sale_date</span> <span class="o">=</span>
				<span class="p">(</span><span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="n">sale_date</span><span class="p">)</span>
				<span class="k">FROM</span> <span class="n">Stocks</span> <span class="n">S2</span>
				<span class="k">WHERE</span> <span class="n">brand</span> <span class="o">=</span> <span class="n">Stocks</span><span class="p">.</span><span class="n">brand</span>
				<span class="k">AND</span> <span class="n">sale_date</span> <span class="o">&lt;</span> <span class="n">Stock</span><span class="p">.</span><span class="n">sale_date</span><span class="p">)))</span>
	<span class="k">WHEN</span> <span class="o">-</span><span class="mi">1</span> <span class="k">THEN</span> <span class="s1">&#39;아래화살표&#39;</span>
	<span class="k">WHEN</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="s1">&#39;오른쪽화살표&#39;</span>
	<span class="k">WHEN</span> <span class="mi">1</span> <span class="k">THEN</span> <span class="s1">&#39;위쪽화살표&#39;</span>
	<span class="k">ELSE</span> <span class="k">NULL</span>
	<span class="k">END</span>
<span class="k">FROM</span> <span class="n">Stocks</span> <span class="n">S2</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>상관서브쿼리 때문에 테이블에 여러번 접근해야 한다.</li>
</ul>

<h3 id="2-윈도우-함수-적용">2. 윈도우 함수 적용</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Stocks2</span>
<span class="k">SELECT</span> <span class="n">brand</span><span class="p">,</span> <span class="n">sale_date</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span>
	<span class="k">CASE</span> <span class="n">SIGN</span><span class="p">(</span><span class="n">price</span> <span class="o">-</span>
		<span class="k">MAX</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">brand</span>
			<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">sale_date</span>
			<span class="k">ROWS</span> <span class="k">BETWEEN</span> <span class="mi">1</span> <span class="n">PRECEDING</span>
			<span class="k">AND</span>  <span class="mi">1</span> <span class="n">PRECEDING</span><span class="p">))</span>
	<span class="k">WHEN</span> <span class="o">-</span><span class="mi">1</span> <span class="k">THEN</span> <span class="s1">&#39;아래화살표&#39;</span>
	<span class="k">WHEN</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="s1">&#39;오른쪽화살표&#39;</span>
	<span class="k">WHEN</span> <span class="mi">1</span> <span class="k">THEN</span> <span class="s1">&#39;위쪽화살표&#39;</span>
	<span class="k">ELSE</span> <span class="k">NULL</span>
	<span class="k">END</span>
<span class="k">FROM</span> <span class="n">Stocks</span> <span class="n">S2</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>매우 간단하고 효율적이 된다.</li>
</ul>

<h3 id="3-insert와-update-어떤-것이-좋을까">3. INSERT와 UPDATE 어떤 것이 좋을까?</h3>

<ul>
<li>INSERT SELECT 장점

<ul>
<li>처리가 더 빠름</li>
<li>자기참조를 허가하지 않는 DB에서도 사용가능</li>
</ul></li>
<li>단점

<ul>
<li>같은 데이털르 두개 만들어야하므로 저장소를 2배 이상 소비</li>
</ul></li>
<li>뷰로 만들어도 되나 트레이드 오프가 있다</li>
</ul>

<h2 id="30강-갱신이-초래하는-트레이드오프">30강. 갱신이 초래하는 트레이드오프</h2>

<ul>
<li>주문일과 배송 예정일 차이가 3일 이상 차이나는 것</li>
</ul>

<h3 id="1-sql을-사용하는-방법">1. SQL을 사용하는 방법</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">O</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span>
	<span class="n">O</span><span class="p">.</span><span class="n">order_name</span><span class="p">,</span>
	<span class="n">ORC</span><span class="p">.</span><span class="n">delivery_date</span> <span class="o">-</span> <span class="n">O</span><span class="p">.</span><span class="n">order_date</span> <span class="k">AS</span> <span class="n">diff_days</span>
<span class="k">FROM</span> <span class="n">Orders</span> <span class="n">O</span>
		<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">OrderReceipts</span> <span class="n">ORC</span>
		<span class="k">ON</span> <span class="n">O</span><span class="p">.</span><span class="n">order_id</span> <span class="o">=</span> <span class="n">ORC</span><span class="p">.</span><span class="n">order_id</span>
<span class="k">WHERE</span> <span class="n">ORC</span><span class="p">.</span><span class="n">delivery_date</span> <span class="o">-</span> <span class="n">O</span><span class="p">.</span><span class="n">order_date</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>주문별로 최대 지연일을 알고 싶은 경우</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">O</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span>
	<span class="k">MAX</span><span class="p">(</span><span class="n">O</span><span class="p">.</span><span class="n">order_name</span><span class="p">),</span> <span class="c1">-- SELECT 하기 위해 MAX를 사용
</span><span class="c1"></span>	<span class="k">MAX</span><span class="p">(</span><span class="n">ORC</span><span class="p">.</span><span class="n">delivery_date</span> <span class="o">-</span> <span class="n">O</span><span class="p">.</span><span class="n">order_date</span><span class="p">)</span> <span class="k">AS</span> <span class="n">max_diff_days</span>
<span class="k">FROM</span> <span class="n">Orders</span> <span class="n">O</span>
		<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">OrderReceipts</span> <span class="n">ORC</span>
		<span class="k">ON</span> <span class="n">O</span><span class="p">.</span><span class="n">order_id</span> <span class="o">=</span> <span class="n">ORC</span><span class="p">.</span><span class="n">order_id</span>
<span class="k">WHERE</span> <span class="n">ORC</span><span class="p">.</span><span class="n">delivery_date</span> <span class="o">-</span> <span class="n">O</span><span class="p">.</span><span class="n">order_date</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">O</span><span class="p">.</span><span class="n">order_id</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="2-모델-갱신을-사용하는-방법">2. 모델 갱신을 사용하는 방법</h3>

<ul>
<li>쿼리를 통해 찾는게 아니라 필드를 하나 추가해 해결할수도 있을 것</li>
<li>코딩 외의 방법도 해결수단이 된다.</li>
</ul>

<h2 id="31강-모델-갱신의-주의점">31강. 모델 갱신의 주의점</h2>

<ul>
<li>3가지의 트레이드 오프가 있다</li>
</ul>

<h3 id="1-높아지는-갱신-비용">1. 높아지는 갱신 비용</h3>

<ul>
<li>배송 지연 플래그 필드를 갱신하는 비용이 든다</li>
</ul>

<h3 id="2-갱신까지의-시간-랙-발생">2. 갱신까지의 시간 랙 발생</h3>

<ul>
<li>갱신 되기 전까지의 시간차이가 발생</li>
</ul>

<h3 id="3-모델-갱신-비용-발생">3. 모델 갱신 비용 발생</h3>

<ul>
<li>모델의 수정은 대단히 큰 수정이 요구됨, 특히나 이미 운영을 시작했다면 더욱 더</li>
</ul>

<h2 id="32강-시야-협착-관련-문제">32강. 시야 협착 : 관련 문제</h2>

<ul>
<li>시야 협착에 빠지기 쉬운 경우를 살펴본다</li>
<li>31강의 문제를 그대로 사용한다</li>
<li>주문번호마다 몇개의 상품이 주문되었는지 확인(주문번호, 주문자 이름, 주문일, 상품수)</li>
</ul>

<h3 id="1-다시-sql을-사용한다면">1. 다시 SQL을 사용한다면</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">O</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span>
	<span class="k">MAX</span><span class="p">(</span><span class="n">O</span><span class="p">.</span><span class="n">order_name</span><span class="p">)</span> <span class="k">AS</span> <span class="n">order_name</span><span class="p">,</span>
	<span class="k">MAX</span><span class="p">(</span><span class="n">O</span><span class="p">.</span><span class="n">order_date</span><span class="p">)</span> <span class="k">AS</span> <span class="n">order_date</span><span class="p">,</span>
	<span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="n">item_count</span>
<span class="k">FROM</span> <span class="n">Orders</span> <span class="n">O</span>
	<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">OrderReceipts</span> <span class="n">ORC</span>
		<span class="k">ON</span> <span class="n">O</span><span class="p">.</span><span class="n">order_id</span> <span class="o">=</span> <span class="n">ORC</span><span class="p">.</span><span class="n">order_id</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">O</span><span class="p">.</span><span class="n">order_id</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">O</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span>
	   <span class="n">O</span><span class="p">.</span><span class="n">order_name</span><span class="p">,</span>
	   <span class="n">O</span><span class="p">.</span><span class="n">order_date</span><span class="p">,</span>
	   <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">O</span><span class="p">.</span><span class="n">order_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">item_count</span>
<span class="k">FROM</span> <span class="n">Orders</span> <span class="n">O</span>
	<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">OrderReceipts</span> <span class="n">ORC</span>
		<span class="k">ON</span> <span class="n">O</span><span class="p">.</span><span class="n">order_id</span> <span class="o">=</span> <span class="n">ORC</span><span class="p">.</span><span class="n">order_id</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>집약을 쓰든 윈도우 함수를 쓰든 모두 결합과 집약을 수행하기 때문에 실행 비용은 비슷하다. 가독성과 확장성 측면에서 윈도우 함수를 쓰는 것이 더 좋다.</li>
</ul>

<h3 id="2-다시-모델-갱신을-사용한다면">2. 다시 모델 갱신을 사용한다면</h3>

<ul>
<li>주문이 등록될 때 수를 알 수 있으므로 필드를 추가해 개수를 넣기 쉽다. 다만, 주문 변경이 일어나는 경우의 처리를 고려해야 한다.</li>
</ul>

<h3 id="3-초보자보다-중급자가-경계해야">3. 초보자보다 중급자가 경계해야</h3>

<h2 id="33강-데이터-모델을-지배하는-자가-시스템을-지배한다">33강. 데이터 모델을 지배하는 자가 시스템을 지배한다.</h2>

<ul>
<li>현명한 데이터 구조와 멍청한 코드의 조합이 멍청한 데이터 구조와 현명한 코드의 조합보다 좋다.</li>
<li>엔지니어의 사명은 전략적 실패를 만회하는 전술을 찾는 것이 아닌 올바른 전략을 고려하는 것</li>
</ul>

<h2 id="34강-인덱스와-b-tree">34강. 인덱스와 B-tree</h2>

<ul>
<li>RDB의 인덱스 구조, 1. B-tree, 2. 비트맵, 3. 해시</li>
</ul>

<h3 id="1-만능형-b-tree">1. 만능형 : B-tree</h3>

<ul>
<li>대부분 DB의 B+tree 라는 수정 버전을 사용한다.</li>
<li>B+tree는 리프노드에만 키값을 저장한다.</li>
<li>B+tree는 루트와 리프의 거리를 가능한 일정하게 유지하려고 하기 때문에 검색 속도가 안정적이다.</li>
</ul>

<h3 id="2-기타-인덱스">2. 기타 인덱스</h3>

<ul>
<li>비트맵 인덱스 : 데이터를 비트 플래그로 변환해서 저장하는 형태의 인덱스로 카디널리티가 낮은 필드에 대해 효과를 발휘한다. 하지만 갱신할 때 오버헤드가 키 BI/DWH 용도로 사용된다.</li>
<li>해시 인덱스 : 검색 외에 효과가 없어 거의 사용되지 않는다.</li>
</ul>

<h2 id="35강-인덱스를-잘-활용하려면">35강. 인덱스를 잘 활용하려면</h2>

<ul>
<li>B+tree는 양이 증가해도 검색이 안정적이고, 범위 검색도 쉬움</li>
</ul>

<h3 id="1-카디널리티-값의-균형-와-선택률-전체중에서-몇개가-선택되는지">1. 카디널리티(값의 균형)와 선택률(전체중에서 몇개가 선택되는지)</h3>

<ul>
<li>클러스터링 팩터(저장소에 같은 값이 어느정도 물리적으로 뭉쳐 존재하는지)가 낮을수록 좋다. 하지만 이것은 구현에 의족한다.</li>
</ul>

<h3 id="2-인덱스를-사용하는-것이-좋은지-판단하려면">2. 인덱스를 사용하는 것이 좋은지 판단하려면</h3>

<ul>
<li>카디널리티가 높은 것</li>
<li>선택률이 낮은 것 5 ~ 10 % 이하, 저장소의 성능향상과 반비례한다.</li>
</ul>

<h2 id="36강-인덱스로-성능-향상이-어려운-경우">36강. 인덱스로 성능 향상이 어려운 경우</h2>

<ul>
<li>인덱스 설계는 테이블 정의와 SQL만 봐서는 할 수 없다.</li>
</ul>

<h3 id="1-압축-조건이-존재하지-않음">1. 압축 조건이 존재하지 않음</h3>

<ul>
<li>WHERE 구가 없이 SELECT 하는 경우</li>
</ul>

<h3 id="2-레코드를-제대로-압축하지-못하는-경우">2. 레코드를 제대로 압축하지 못하는 경우</h3>

<ul>
<li>WHERE 구 조건의 선택률이 너무 높아 인덱스를 만들기 비효율적이다.</li>
</ul>

<h4 id="1-입력-매개변수에-따라-선택률이-변동하는-경우-1">1) 입력 매개변수에 따라 선택률이 변동하는 경우 - 1</h4>

<h4 id="2-입력-매개변수에-따라-선택률이-변동하는-경우-2">2) 입력 매개변수에 따라 선택률이 변동하는 경우 - 2</h4>

<h3 id="3-인덱스를-사용하지-않는-검색-조건">3. 인덱스를 사용하지 않는 검색 조건</h3>

<h4 id="1-중간-일치-후방-일치-like-연산자">1) 중간 일치, 후방 일치 LIKE 연산자</h4>

<ul>
<li>LIKE를 사용하는 경우 인덱스는 전방일치에만 적용 가능하다.</li>
</ul>

<h4 id="2-색인-필드로-연산하는-경우-함수를-적요하는-경우에도-안됨">2) 색인 필드로 연산하는 경우(함수를 적요하는 경우에도 안됨)</h4>

<ul>
<li>다음과 같이 바꾸면 됨</li>
<li>WHERE col_1 * 1.1 &gt; 100 -&gt; col_1 &gt; <sup>100</sup>&frasl;<sub>1</sub>.1</li>
</ul>

<h4 id="3-is-null을-사용하는-경우">3) IS NULL을 사용하는 경우</h4>

<ul>
<li>색인 필드 데이터에는 NULL이 존재하지 않기 때문에 인덱스를 사용불가</li>
</ul>

<h4 id="4-부정형을-사용하는-경우">4) 부정형을 사용하는 경우</h4>

<ul>
<li>&lt;&gt;, !=, NOT IN</li>
</ul>

<h2 id="37강-인덱스를-사용할-수-없는-경우-대처법">37강. 인덱스를 사용할 수 없는 경우 대처법</h2>

<h3 id="1-외부-설정으로-처리-깊고-어두운-강-건너기">1. 외부 설정으로 처리 - 깊고 어두운 강 건너기</h3>

<h4 id="1-ui-설계로-처리">1) UI 설계로 처리</h4>

<ul>
<li>사용자가 선택할 수 있는 조건을 제한한다.</li>
</ul>

<h3 id="2-외부-설정을-사용한-대처-방법의-주의점">2. 외부 설정을 사용한 대처 방법의 주의점</h3>

<ul>
<li>개발전에 합의해야 한다. 서로의 이해관계를 파악하는 것이 중요!</li>
</ul>

<h3 id="3-데이터-맡로-대처">3. 데이터 맡로 대처</h3>

<ul>
<li>특정한 쿼리에서 필요한 데이터만을 저장하는, 상대적으로 작은 크기의 테이블이다. 서브셋</li>
<li>원래 대규모의 데이터를 다뤄야 하는(성능 조건이 중요함) BI/DWH 분야에 사용되는 기술이다. 접근 대상 테이블의 크기를 작게해서 I/O양을 줄이는 것이 목적이다.</li>
</ul>

<h3 id="4-데이터-마트를-채택할-시-주의점">4. 데이터 마트를 채택할 시 주의점</h3>

<h4 id="1-데이터-신선도">1) 데이터 신선도</h4>

<ul>
<li>동기 시점에 따라 신선도와 성능간의 트레이드 오프 고려 할 것</li>
</ul>

<h4 id="2-데이터-마트-크기">2) 데이터 마트 크기</h4>

<ul>
<li>I/0 양을 줄이는 것이 목적이므로 테이블의 크기가 딱히 줄어들지 않는다면 필요없다.</li>
<li>GROUP BY절을 미리 사용해 집계를 마치고 데이터 마트로 만들면 필드 수와 레코드수를 크게 줄일 수 있다.</li>
</ul>

<h4 id="3-데이터-마트수">3) 데이터 마트수</h4>

<ul>
<li>목적에 맞게 잘 만들어 관리해야, 용량과 성능문제가 안생긴다.</li>
<li>빠르다고 무작점 만들어서 쓰면 안됨</li>
</ul>

<h4 id="4-배치-윈도우">4) 배치 윈도우</h4>

<ul>
<li>데이터 마트도 만드는데 시간이 걸리고 변경에 따른 갱신도 발생하므로 배치 윈도우를 압박한다. 배치윈도우와 Job Net도 고려할 것</li>
</ul>

<h3 id="5-인덱스-온리-스캔으로-대처">5. 인덱스 온리 스캔으로 대처</h3>

<ul>
<li>I/O 감소를 목적으로하는 데이터 마트와 접근이 같고, 데이터 동기 문제를 해결할 수 있다.</li>
<li>풀 스캔을 할 때 검사대상을 테이블이 아닌 인덱스로 바꿀 수 있다.</li>
<li>압축 요건이 존재하지 않는 경우</li>
<li>CREATE INDEX CoveringIndex ON Orders (order_id, receive_date);</li>
<li>SQL 구문에서 필요한 필드를 인덱스만으로 커버할 수 있는 경우, 테이블 접근을 생략하는 기술 이다.</li>
<li>레코드를 제대로 압축하지 못하는 검색 조건</li>
<li>CREATE INDEX CoveringIndex_1 ON Orders (process_flg, order_id, receive_date);</li>
<li>압축은 되지만 인덱스를 사용하지 않는 검색 조건</li>
<li>CREATE INDEX CoveringIndex_2 ON Orders (shop_name, order_id, receive_date);</li>
<li>로우 지향 DB를 컬럼 지향 DB로 만드는 방법이라고 생각하면 된다.</li>
</ul>

<h3 id="6-인덱스-온리-스캔의-주의사항">6. 인덱스 온리 스캔의 주의사항</h3>

<h4 id="1-dbms에-따라-사용할-수-없는-경우도-있다">1) DBMS에 따라 사용할 수 없는 경우도 있다.</h4>

<h4 id="2-한-개의-인덱스에-포함할-수-있는-필드-수에-제한이-있다">2) 한 개의 인덱스에 포함할 수 있는 필드 수에 제한이 있다.</h4>

<h4 id="3-갱신-오버-헤드가-커진다">3) 갱신 오버 헤드가 커진다.</h4>

<ul>
<li>커버링 인덱스는 성질살 필연적으로 필드 수가 많아 크기가 큰 인덱스가 되기 쉽다.</li>
<li>따라서 테이블을 갱신할 때의 오버헤드도 일반적인 인덱스에 비해 커진다.</li>
</ul>

<h4 id="4-정기적인-인덱스-리빌드가-필요">4) 정기적인 인덱스 리빌드가 필요</h4>

<ul>
<li>인덱스에만 접근한다는 것은 성능이 인덱스의 크기에 의존한다는 것이다. 따라서 정기적인 모니터링과 리빌드를 필요로 한다.</li>
</ul>

<h4 id="5-sql에-새로운-필드가-추가되면-사용할-수-없다">5) SQL에 새로운 필드가 추가되면 사용할 수 없다.</h4>

<ul>
<li>일반적인 인덱스에 비해 어플리케이션 유지 보수에 약한 타입의 튜닝이라고 할 수 있다.</li>
</ul>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Jaejin Jang</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2019-05-29
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content">Jaejin Jang</span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/sql-%ED%8A%9C%EB%8B%9D/">sql 튜닝</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/posts183/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">으아 피곤해</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/posts181/">
            <span class="next-text nav-default">책뿌수기 - SQL 레벨업 8</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:jaejin0me@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://ko-kr.facebook.com/people/%EC%9E%A5%EC%9E%AC%EC%A7%84/100005230447628" class="iconfont icon-facebook" title="facebook"></a>
      <a href="https://www.linkedin.com/in/jaejin0me" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/jaejin0me" class="iconfont icon-github" title="github"></a>
  <a href="https://jaejin0me.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2019
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Jaejin Jang</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-111561979-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
